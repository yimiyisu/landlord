"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t,a=e(require("axios")),n=require("stream"),o=e(require("lodash/get")),i=e(require("lodash/set")),r=e(require("qs")),c=e(require("fs")),s=e(require("fs/promises")),l=require("util"),p=e(require("debug")),u=require("tos-crc64-js"),d=e(require("crypto-js/md5")),h=e(require("crypto-js/enc-base64")),f=e(require("crypto-js/enc-hex")),m=e(require("crypto-js/enc-utf8")),y=e(require("crypto")),g=e(require("path")),x=e(require("lodash/cloneDeep")),b=e(require("http")),k=e(require("https")),v=e(require("os"));class T extends Error{constructor(e){const{data:t}=e;super(t.Message),this.code=void 0,this.data=void 0,this.statusCode=void 0,this.headers=void 0,this.requestId=void 0,this.id2=void 0,Object.setPrototypeOf(this,T.prototype),this.data=t,this.code=t.Code,this.statusCode=e.status,this.headers=e.headers,this.requestId=e.headers["x-tos-request-id"],this.id2=e.headers["x-tos-id-2"]}}(t=exports.TosServerCode||(exports.TosServerCode={})).NoSuchBucket="NoSuchBucket",t.NoSuchKey="NoSuchKey",t.AccessDenied="AccessDenied",t.MalformedAcl="MalformedAclError",t.UnexpectedContent="UnexpectedContent",t.InvalidRequest="InvalidRequest",t.MissingSecurityHeader="MissingSecurityHeader",t.InvalidArgument="InvalidArgument",t.EntityTooSmall="EntityTooSmall",t.InvalidBucketName="InvalidBucketName",t.BucketNotEmpty="BucketNotEmpty",t.TooManyBuckets="TooManyBuckets",t.BucketAlreadyExists="BucketAlreadyExists",t.MalformedBody="MalformedBody",t.NoSuchLifecycleConfiguration="NoSuchLifecycleConfiguration",t.ReplicationConfigurationNotFound="ReplicationConfigurationNotFoundError",t.InvalidLocationConstraint="InvalidLocationConstraint",t.AuthorizationQueryParametersError="AuthorizationQueryParametersError",t.RequestTimeTooSkewed="RequestTimeTooSkewed",t.SignatureDoesNotMatch="SignatureDoesNotMatch",t.RequestedRangeNotSatisfiable="Requested Range Not Satisfiable",t.PreconditionFailed="PreconditionFailed",t.BadDigest="BadDigest",t.InvalidDigest="InvalidDigest",t.EntityTooLarge="EntityTooLarge",t.UnImplemented="UnImplemented",t.MethodNotAllowed="MethodNotAllowed",t.InvalidAccessKeyId="InvalidAccessKeyId",t.InvalidSecurityToken="InvalidSecurityToken",t.ContentSHA256Mismatch="ContentSHA256Mismatch",t.ExceedQPSLimit="ExceedQPSLimit",t.ExceedRateLimit="ExceedRateLimit",t.NoSuchCORSConfiguration="NoSuchCORSConfiguration",t.NoSuchMirrorConfiguration="NoSuchMirrorConfiguration",t.NoSuchWebsiteConfiguration="NoSuchWebsiteConfiguration",t.MissingRequestBody="MissingRequestBodyError",t.BucketAlreadyOwnedByYou="BucketAlreadyOwnedByYou",t.NoSuchBucketPolicy="NoSuchBucketPolicy",t.PolicyTooLarge="PolicyTooLarge",t.MalformedPolicy="MalformedPolicy",t.InvalidKey="InvalidKey",t.MirrorFailed="MirrorFailed",t.Timeout="Timeout",t.OffsetNotMatched="OffsetNotMatched",t.NotAppendable="NotAppendable",t.ContextCanceled="ContextCanceled",t.InternalError="InternalError",t.TooManyRequests="TooManyRequests",t.TimeOut="TimeOut",t.ConcurrencyUpdateObjectLimit="ConcurrencyUpdateObjectLimit",t.DuplicateUpload="DuplicateUpload",t.DuplicateObject="DuplicateObject",t.InvalidVersionId="InvalidVersionId",t.StorageClassNotMatch="StorageClassNotMatch",t.UploadStatusNotUploading="UploadStatusNotUploading",t.PartSizeNotMatch="PartSizeNotMatch",t.NoUploadPart="NoUploadPart",t.PartsLenInvalid="PartsLenInvalid",t.PartsIdxSmall="PartsIdxSmall",t.PartSizeSmall="PartSizeSmall",t.PrefixNotNextKeyPrefix="PrefixNotNextKeyPrefix",t.InvalidPart="InvalidPart",t.InvalidPartOffset="InvalidPartOffset",t.MismatchObject="MismatchObject",t.UploadStatusMismatch="UploadStatusMismatch",t.CompletingStatusNoExpiration="CompletingStatusNoExpiration",t.Found="Found",t.InvalidRedirectLocation="InvalidRedirectLocation";class w extends Error{constructor(e){super(e),Object.setPrototypeOf(this,w.prototype)}}class S extends Error{constructor(e){super(e),Object.setPrototypeOf(this,S.prototype)}}const E=c.createWriteStream,C=c.createReadStream,P=l.promisify(c.rename),R=l.promisify(c.stat),B=l.promisify(c.writeFile),I=l.promisify(c.unlink),A=l.promisify(c.readFile),O=async e=>{try{await s.access(e)}catch(t){await s.mkdir(e,{recursive:!0})}},M=p("TOS"),D=e=>t=>{if(null==e||"object"!=typeof e)return;const a=o(e,t);Array.isArray(a)||i(e,t,null==a?[]:[a])},j=e=>{const t=a=>Array.isArray(a)?a.map(e=>t(e)):"string"==typeof a?e(a):"object"==typeof a&&null!=a?Object.keys(a).reduce((e,n)=>(e[t(n)]=a[n],e),{}):a;return t},_=j(e=>e.replace(/[A-Z]/g,"-$&").toLowerCase()),L=j(e=>e[0].toUpperCase()+e.slice(1)),U=e=>{const t=[];return Object.keys(e).sort().forEach(a=>{t.push(`${encodeURIComponent(a)}=${encodeURIComponent(e[a])}`)}),t.join("&")},N=e=>{const t=e||{},a={};Object.keys(t).forEach(e=>{null!=t[e]&&(a[e]=t[e])});const n={};return Object.keys(a).forEach(e=>{const t=e.toLowerCase();n[t]=a[e]}),n},z=e=>("string"==typeof e&&(e={url:e}),e);async function F(e){try{return[null,await e]}catch(e){return[e,null]}}function K(e){return"undefined"!=typeof Blob&&e instanceof Blob}function q(e){return"undefined"!=typeof Buffer&&e instanceof Buffer}function G(e){return e instanceof n.Readable}function $(e){return e?Object.keys(e).map(t=>{const a=""+e[t];return`${encodeURIComponent(t)}=${encodeURIComponent(a)}`}).join("&"):""}function H(e){return e instanceof S}const W=e=>"string"==typeof e?e:e.toUTCString(),V={projectName:"x-tos-project-name",encodingType:"encoding-type",cacheControl:"cache-control",contentDisposition:"content-disposition",contentLength:"content-length",contentMD5:"content-md5",contentSHA256:"x-tos-content-sha256",contentEncoding:"content-encoding",contentLanguage:"content-language",contentType:"content-type",expires:["expires",e=>e.toUTCString()],range:"range",ifMatch:"if-match",ifModifiedSince:["if-modified-since",W],ifNoneMatch:"if-none-match",ifUnmodifiedSince:["if-unmodified-since",W],acl:"x-tos-acl",grantFullControl:"x-tos-grant-full-control",grantRead:"x-tos-grant-read",grantReadAcp:"x-tos-grant-read-acp",grantWrite:"x-tos-grant-write",grantWriteAcp:"x-tos-grant-write-acp",serverSideEncryption:"x-tos-server-side-encryption",serverSideDataEncryption:"x-tos-server-side-data-encryption",ssecAlgorithm:"x-tos-server-side-encryption-customer-algorithm",ssecKey:"x-tos-server-side-encryption-customer-key",ssecKeyMD5:"x-tos-server-side-encryption-customer-key-md5",copySourceRange:"x-tos-copy-source-range",copySourceIfMatch:"x-tos-copy-source-if-match",copySourceIfModifiedSince:["x-tos-copy-source-if-modified-since",W],copySourceIfNoneMatch:"x-tos-copy-source-if-none-match",copySourceIfUnmodifiedSince:"x-tos-copy-source-if-unmodified-since",copySourceSSECAlgorithm:"x-tos-copy-source-server-side-encryption-customer-algorithm",copySourceSSECKey:"x-tos-copy-source-server-side-encryption-customer-key",copySourceSSECKeyMD5:"x-tos-copy-source-server-side-encryption-customer-key-MD5",metadataDirective:"x-tos-metadata-directive",meta:e=>Object.keys(e).reduce((t,a)=>(t["x-tos-meta-"+a]=""+e[a],t),{}),websiteRedirectLocation:"x-tos-website-redirect-location",storageClass:"x-tos-storage-class",azRedundancy:"x-tos-az-redundancy",trafficLimit:"x-tos-traffic-limit",callback:"x-tos-callback",callbackVar:"x-tos-callback-var",allowSameActionOverlap:["x-tos-allow-same-action-overlap",e=>String(e)],symLinkTargetKey:"x-tos-symlink-target",symLinkTargetBucket:"x-tos-symlink-bucket",forbidOverwrite:"x-tos-forbid-overwrite",bucketType:"x-tos-bucket-type",recursiveMkdir:"x-tos-recursive-mkdir"},J={versionId:"versionId",process:"x-tos-process",saveBucket:"x-tos-save-bucket",saveObject:"x-tos-save-object",responseCacheControl:"response-cache-control",responseContentDisposition:"response-content-disposition",responseContentEncoding:"response-content-encoding",responseContentLanguage:"response-content-language",responseContentType:"response-content-type",responseExpires:["response-expires",e=>e.toUTCString()]};function Q(e,t){if(!t.length)return;const a=e.headers||{};function n(e,t){null==a[e]&&(a[e]=t)}e.headers=a,t.forEach(t=>{const a=V[t];if(!a)throw new w(`\`${t}\` isn't in keys of \`requestHeadersMap\``);const o=e[t];if(null==o)return;if("string"==typeof a)return n(a,""+o);if(Array.isArray(a))return n(a[0],a[1](o));const i=a(o);Object.entries(i).forEach(([e,t])=>{n(e,t)})})}const X=e=>r.stringify(e);function Y(e,t){return{data:e,statusCode:t.statusCode,headers:t.headers,requestId:t.requestId,id2:t.id2}}function Z(e,t){const a=t["x-tos-hash-crc64ecma"];if(null==a)return;const n="string"==typeof e?e:e.getCrc64();if(n!==a)throw new w(`validate file crc64 failed. Expect crc64 ${a}, actual crc64 ${n}. Please try again.`)}const ee=(e,t)=>e.on("error",e=>{M("bindStreamErrorHandler: ",(t||"")+" stream error:",e)});var te;!function(e){e.LastModified="last-modified",e.ContentLength="content-length",e.AcceptEncoding="accept-encoding",e.ContentEncoding="content-encoding",e.ContentMD5="content-md5",e.TosRawContentLength="x-tos-raw-content-length",e.TosTrailer="x-tos-trailer",e.TosHashCrc64ecma="x-tos-hash-crc64ecma",e.TosContentSha256="x-tos-content-sha256",e.TosDecodedContentLength="x-tos-decoded-content-length",e.TosEc="x-tos-ec",e.TosRequestId="x-tos-request-id"}(te||(te={}));const ae=e=>{let t=Promise.resolve();return async()=>(t=t.then(()=>e()),t)},ne=async e=>{try{return JSON.parse(await A(e,"utf-8"))}catch(e){return void console.warn("checkpoint's content is not a valid JSON")}},oe=e=>{let t=null;return{getLastStream:()=>t,make:()=>(t&&(ee(t,"retry new stream"),ie(t,new Error("retry new stream by makeRetryStreamAutoClose"))),t=e(),t)}},ie=(e,t)=>{e&&"destroy"in e&&"function"==typeof e.destroy&&"destroyed"in e&&!e.destroyed&&e.destroy(t)},re=(e,t,a)=>(ee(t,a),e.on("error",e=>ie(t,e)),t.on("error",t=>ie(e,t)),e.pipe(t)),ce=(e,t)=>{if(!t&&e){if(e.length<3||e.length>63)throw new w("invalid bucket name, the length must be [3, 63]");if(!/^([a-z]|-|\d)+$/.test(e))throw new w("invalid bucket name, the character set is illegal");if(/^-/.test(e)||/-$/.test(e))throw new w("invalid bucket name, the bucket name can be neither starting with '-' nor ending with '-'")}};async function se(e){e=this.normalizeObjectInput(e);const t=N(e.headers);return e.headers=t,Q(e,["encodingType","cacheControl","contentDisposition","contentEncoding","contentLanguage","contentType","expires","acl","grantFullControl","grantRead","grantReadAcp","grantWriteAcp","ssecAlgorithm","ssecKey","ssecKeyMD5","serverSideEncryption","serverSideDataEncryption","meta","websiteRedirectLocation","storageClass","forbidOverwrite"]),this.setObjectContentTypeHeader(e,t),this._fetchObject(e,"POST",{uploads:""},t,"")}const le=(e,t,a=!1)=>{let n=t;t<5242880&&(n=5242880,a&&console.warn(`partSize has been set to ${n}, because the partSize you provided is less than the minimal size of multipart`));const o=Math.ceil(e/1e4);return t<o&&(n=o,a&&console.warn(`partSize has been set to ${n}, because the partSize you provided causes the number of part excesses 10,000`)),n};async function pe(e){const{uploadId:t,...a}=e,n=await this._fetchObject(e,"GET",{uploadId:t,..._(a)},{});return D(n.data)("Parts"),n}const ue={"3gp":"video/3gpp","7z":"application/x-7z-compressed",abw:"application/x-abiword",ai:"application/postscript",aif:"audio/x-aiff",aifc:"audio/x-aiff",aiff:"audio/x-aiff",alc:"chemical/x-alchemy",amr:"audio/amr",anx:"application/annodex",apk:"application/vnd.android.package-archive",appcache:"text/cache-manifest",art:"image/x-jg",asc:"text/plain",asf:"video/x-ms-asf",aso:"chemical/x-ncbi-asn1-binary",asx:"video/x-ms-asf",atom:"application/atom+xml",atomcat:"application/atomcat+xml",atomsrv:"application/atomserv+xml",au:"audio/basic",avi:"video/x-msvideo",awb:"audio/amr-wb",axa:"audio/annodex",axv:"video/annodex",b:"chemical/x-molconn-Z",bak:"application/x-trash",bat:"application/x-msdos-program",bcpio:"application/x-bcpio",bib:"text/x-bibtex",bin:"application/octet-stream",bmp:"image/x-ms-bmp",boo:"text/x-boo",book:"application/x-maker",brf:"text/plain",bsd:"chemical/x-crossfire",c:"text/x-csrc","c++":"text/x-c++src",c3d:"chemical/x-chem3d",cab:"application/x-cab",cac:"chemical/x-cache",cache:"chemical/x-cache",cap:"application/vnd.tcpdump.pcap",cascii:"chemical/x-cactvs-binary",cat:"application/vnd.ms-pki.seccat",cbin:"chemical/x-cactvs-binary",cbr:"application/x-cbr",cbz:"application/x-cbz",cc:"text/x-c++src",cda:"application/x-cdf",cdf:"application/x-cdf",cdr:"image/x-coreldraw",cdt:"image/x-coreldrawtemplate",cdx:"chemical/x-cdx",cdy:"application/vnd.cinderella",cef:"chemical/x-cxf",cer:"chemical/x-cerius",chm:"chemical/x-chemdraw",chrt:"application/x-kchart",cif:"chemical/x-cif",class:"application/java-vm",cls:"text/x-tex",cmdf:"chemical/x-cmdf",cml:"chemical/x-cml",cod:"application/vnd.rim.cod",com:"application/x-msdos-program",cpa:"chemical/x-compass",cpio:"application/x-cpio",cpp:"text/x-c++src",cpt:"application/mac-compactpro",cr2:"image/x-canon-cr2",crl:"application/x-pkcs7-crl",crt:"application/x-x509-ca-cert",crw:"image/x-canon-crw",csd:"audio/csound",csf:"chemical/x-cache-csf",csh:"application/x-csh",csm:"chemical/x-csml",csml:"chemical/x-csml",css:"text/css",csv:"text/csv",ctab:"chemical/x-cactvs-binary",ctx:"chemical/x-ctx",cu:"application/cu-seeme",cub:"chemical/x-gaussian-cube",cxf:"chemical/x-cxf",cxx:"text/x-c++src",d:"text/x-dsrc",davmount:"application/davmount+xml",dcm:"application/dicom",dcr:"application/x-director",ddeb:"application/vnd.debian.binary-package",dif:"video/dv",diff:"text/x-diff",dir:"application/x-director",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",dl:"video/dl",dll:"application/x-msdos-program",dmg:"application/x-apple-diskimage",dms:"application/x-dms",doc:"application/msword",docm:"application/vnd.ms-word.document.macroEnabled.12",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dot:"application/msword",dotm:"application/vnd.ms-word.template.macroEnabled.12",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",dv:"video/dv",dvi:"application/x-dvi",dx:"chemical/x-jcamp-dx",dxr:"application/x-director",emb:"chemical/x-embl-dl-nucleotide",embl:"chemical/x-embl-dl-nucleotide",eml:"message/rfc822",eot:"application/vnd.ms-fontobject",eps:"application/postscript",eps2:"application/postscript",eps3:"application/postscript",epsf:"application/postscript",epsi:"application/postscript",erf:"image/x-epson-erf",es:"application/ecmascript",etx:"text/x-setext",exe:"application/x-msdos-program",ez:"application/andrew-inset",fb:"application/x-maker",fbdoc:"application/x-maker",fch:"chemical/x-gaussian-checkpoint",fchk:"chemical/x-gaussian-checkpoint",fig:"application/x-xfig",flac:"audio/flac",fli:"video/fli",flv:"video/x-flv",fm:"application/x-maker",frame:"application/x-maker",frm:"application/x-maker",gal:"chemical/x-gaussian-log",gam:"chemical/x-gamess-input",gamin:"chemical/x-gamess-input",gan:"application/x-ganttproject",gau:"chemical/x-gaussian-input",gcd:"text/x-pcs-gcd",gcf:"application/x-graphing-calculator",gcg:"chemical/x-gcg8-sequence",gen:"chemical/x-genbank",gf:"application/x-tex-gf",gif:"image/gif",gjc:"chemical/x-gaussian-input",gjf:"chemical/x-gaussian-input",gl:"video/gl",gnumeric:"application/x-gnumeric",gpt:"chemical/x-mopac-graph",gsf:"application/x-font",gsm:"audio/x-gsm",gtar:"application/x-gtar",gz:"application/gzip",h:"text/x-chdr","h++":"text/x-c++hdr",hdf:"application/x-hdf",hh:"text/x-c++hdr",hin:"chemical/x-hin",hpp:"text/x-c++hdr",hqx:"application/mac-binhex40",hs:"text/x-haskell",hta:"application/hta",htc:"text/x-component",htm:"text/html",html:"text/html",hwp:"application/x-hwp",hxx:"text/x-c++hdr",ica:"application/x-ica",ice:"x-conference/x-cooltalk",ico:"image/vnd.microsoft.icon",ics:"text/calendar",icz:"text/calendar",ief:"image/ief",iges:"model/iges",igs:"model/iges",iii:"application/x-iphone",info:"application/x-info",inp:"chemical/x-gamess-input",ins:"application/x-internet-signup",iso:"application/x-iso9660-image",isp:"application/x-internet-signup",ist:"chemical/x-isostar",istr:"chemical/x-isostar",jad:"text/vnd.sun.j2me.app-descriptor",jam:"application/x-jam",jar:"application/java-archive",java:"text/x-java",jdx:"chemical/x-jcamp-dx",jmz:"application/x-jmol",jng:"image/x-jng",jnlp:"application/x-java-jnlp-file",jp2:"image/jp2",jpe:"image/jpeg",jpeg:"image/jpeg",jpf:"image/jpx",jpg:"image/jpeg",jpg2:"image/jp2",jpm:"image/jpm",jpx:"image/jpx",js:"application/javascript",json:"application/json",kar:"audio/midi",key:"application/pgp-keys",kil:"application/x-killustrator",kin:"chemical/x-kinemage",kml:"application/vnd.google-earth.kml+xml",kmz:"application/vnd.google-earth.kmz",kpr:"application/x-kpresenter",kpt:"application/x-kpresenter",ksp:"application/x-kspread",kwd:"application/x-kword",kwt:"application/x-kword",latex:"application/x-latex",lha:"application/x-lha",lhs:"text/x-literate-haskell",lin:"application/bbolin",lsf:"video/x-la-asf",lsx:"video/x-la-asf",ltx:"text/x-tex",ly:"text/x-lilypond",lyx:"application/x-lyx",lzh:"application/x-lzh",lzx:"application/x-lzx",m3g:"application/m3g",m3u:"audio/x-mpegurl",m3u8:"application/x-mpegURL",m4a:"audio/mpeg",maker:"application/x-maker",man:"application/x-troff-man",mbox:"application/mbox",mcif:"chemical/x-mmcif",mcm:"chemical/x-macmolecule",mdb:"application/msaccess",me:"application/x-troff-me",mesh:"model/mesh",mid:"audio/midi",midi:"audio/midi",mif:"application/x-mif",mkv:"video/x-matroska",mm:"application/x-freemind",mmd:"chemical/x-macromodel-input",mmf:"application/vnd.smaf",mml:"text/mathml",mmod:"chemical/x-macromodel-input",mng:"video/x-mng",moc:"text/x-moc",mol:"chemical/x-mdl-molfile",mol2:"chemical/x-mol2",moo:"chemical/x-mopac-out",mop:"chemical/x-mopac-input",mopcrt:"chemical/x-mopac-input",mov:"video/quicktime",movie:"video/x-sgi-movie",mp2:"audio/mpeg",mp3:"audio/mpeg",mp4:"video/mp4",mpc:"chemical/x-mopac-input",mpe:"video/mpeg",mpeg:"video/mpeg",mpega:"audio/mpeg",mpg:"video/mpeg",mpga:"audio/mpeg",mph:"application/x-comsol",mpv:"video/x-matroska",ms:"application/x-troff-ms",msh:"model/mesh",msi:"application/x-msi",mvb:"chemical/x-mopac-vib",mxf:"application/mxf",mxu:"video/vnd.mpegurl",nb:"application/mathematica",nbp:"application/mathematica",nc:"application/x-netcdf",nef:"image/x-nikon-nef",nwc:"application/x-nwc",o:"application/x-object",oda:"application/oda",odb:"application/vnd.oasis.opendocument.database",odc:"application/vnd.oasis.opendocument.chart",odf:"application/vnd.oasis.opendocument.formula",odg:"application/vnd.oasis.opendocument.graphics",odi:"application/vnd.oasis.opendocument.image",odm:"application/vnd.oasis.opendocument.text-master",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogg:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",old:"application/x-trash",one:"application/onenote",onepkg:"application/onenote",onetmp:"application/onenote",onetoc2:"application/onenote",opf:"application/oebps-package+xml",opus:"audio/ogg",orc:"audio/csound",orf:"image/x-olympus-orf",otf:"application/font-sfnt",otg:"application/vnd.oasis.opendocument.graphics-template",oth:"application/vnd.oasis.opendocument.text-web",otp:"application/vnd.oasis.opendocument.presentation-template",ots:"application/vnd.oasis.opendocument.spreadsheet-template",ott:"application/vnd.oasis.opendocument.text-template",oza:"application/x-oz-application",p:"text/x-pascal",p7r:"application/x-pkcs7-certreqresp",pac:"application/x-ns-proxy-autoconfig",pas:"text/x-pascal",pat:"image/x-coreldrawpattern",patch:"text/x-diff",pbm:"image/x-portable-bitmap",pcap:"application/vnd.tcpdump.pcap",pcf:"application/x-font-pcf","pcf.Z":"application/x-font-pcf",pcx:"image/pcx",pdb:"chemical/x-pdb",pdf:"application/pdf",pfa:"application/x-font",pfb:"application/x-font",pfr:"application/font-tdpfr",pgm:"image/x-portable-graymap",pgn:"application/x-chess-pgn",pgp:"application/pgp-encrypted",php:"#application/x-httpd-php",php3:"#application/x-httpd-php3",php3p:"#application/x-httpd-php3-preprocessed",php4:"#application/x-httpd-php4",php5:"#application/x-httpd-php5",phps:"#application/x-httpd-php-source",pht:"#application/x-httpd-php",phtml:"#application/x-httpd-php",pk:"application/x-tex-pk",pl:"text/x-perl",pls:"audio/x-scpls",pm:"text/x-perl",png:"image/png",pnm:"image/x-portable-anymap",pot:"text/plain",potm:"application/vnd.ms-powerpoint.template.macroEnabled.12",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",ppam:"application/vnd.ms-powerpoint.addin.macroEnabled.12",ppm:"image/x-portable-pixmap",pps:"application/vnd.ms-powerpoint",ppsm:"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppt:"application/vnd.ms-powerpoint",pptm:"application/vnd.ms-powerpoint.presentation.macroEnabled.12",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",prf:"application/pics-rules",prt:"chemical/x-ncbi-asn1-ascii",ps:"application/postscript",psd:"image/x-photoshop",py:"text/x-python",pyc:"application/x-python-code",pyo:"application/x-python-code",qgs:"application/x-qgis",qt:"video/quicktime",qtl:"application/x-quicktimeplayer",ra:"audio/x-pn-realaudio",ram:"audio/x-pn-realaudio",rar:"application/rar",ras:"image/x-cmu-raster",rb:"application/x-ruby",rd:"chemical/x-mdl-rdfile",rdf:"application/rdf+xml",rdp:"application/x-rdp",rgb:"image/x-rgb",rhtml:"#application/x-httpd-eruby",rm:"audio/x-pn-realaudio",roff:"application/x-troff",ros:"chemical/x-rosdal",rpm:"application/x-redhat-package-manager",rss:"application/x-rss+xml",rtf:"application/rtf",rtx:"text/richtext",rxn:"chemical/x-mdl-rxnfile",scala:"text/x-scala",sce:"application/x-scilab",sci:"application/x-scilab",sco:"audio/csound",scr:"application/x-silverlight",sct:"text/scriptlet",sd:"chemical/x-mdl-sdfile",sd2:"audio/x-sd2",sda:"application/vnd.stardivision.draw",sdc:"application/vnd.stardivision.calc",sdd:"application/vnd.stardivision.impress",sds:"application/vnd.stardivision.chart",sdw:"application/vnd.stardivision.writer",ser:"application/java-serialized-object",sfd:"application/vnd.font-fontforge-sfd",sfv:"text/x-sfv",sgf:"application/x-go-sgf",sgl:"application/vnd.stardivision.writer-global",sh:"application/x-sh",shar:"application/x-shar",shp:"application/x-qgis",shtml:"text/html",shx:"application/x-qgis",sid:"audio/prs.sid",sig:"application/pgp-signature",sik:"application/x-trash",silo:"model/mesh",sis:"application/vnd.symbian.install",sisx:"x-epoc/x-sisx-app",sit:"application/x-stuffit",sitx:"application/x-stuffit",skd:"application/x-koan",skm:"application/x-koan",skp:"application/x-koan",skt:"application/x-koan",sldm:"application/vnd.ms-powerpoint.slide.macroEnabled.12",sldx:"application/vnd.openxmlformats-officedocument.presentationml.slide",smi:"application/smil+xml",smil:"application/smil+xml",snd:"audio/basic",spc:"chemical/x-galactic-spc",spl:"application/x-futuresplash",spx:"audio/ogg",sql:"application/x-sql",src:"application/x-wais-source",srt:"text/plain",stc:"application/vnd.sun.xml.calc.template",std:"application/vnd.sun.xml.draw.template",sti:"application/vnd.sun.xml.impress.template",stw:"application/vnd.sun.xml.writer.template",sty:"text/x-tex",sv4cpio:"application/x-sv4cpio",sv4crc:"application/x-sv4crc",svg:"image/svg+xml",svgz:"image/svg+xml",sw:"chemical/x-swissprot",swf:"application/x-shockwave-flash",swfl:"application/x-shockwave-flash",sxc:"application/vnd.sun.xml.calc",sxd:"application/vnd.sun.xml.draw",sxg:"application/vnd.sun.xml.writer.global",sxi:"application/vnd.sun.xml.impress",sxm:"application/vnd.sun.xml.math",sxw:"application/vnd.sun.xml.writer",t:"application/x-troff",tar:"application/x-tar",taz:"application/x-gtar-compressed",tcl:"application/x-tcl",tex:"text/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",text:"text/plain",tgf:"chemical/x-mdl-tgf",tgz:"application/x-gtar-compressed",thmx:"application/vnd.ms-officetheme",tif:"image/tiff",tiff:"image/tiff",tk:"text/x-tcl",tm:"text/texmacs",torrent:"application/x-bittorrent",tr:"application/x-troff",ts:"video/MP2T",tsp:"application/dsptype",tsv:"text/tab-separated-values",ttf:"application/font-sfnt",ttl:"text/turtle",txt:"text/plain",uls:"text/iuls",ustar:"application/x-ustar",val:"chemical/x-ncbi-asn1-binary",vcard:"text/vcard",vcd:"application/x-cdlink",vcf:"text/vcard",vcs:"text/x-vcalendar",vmd:"chemical/x-vmd",vms:"chemical/x-vamas-iso14976",vrm:"x-world/x-vrml",vrml:"model/vrml",vsd:"application/vnd.visio",vss:"application/vnd.visio",vst:"application/vnd.visio",vsw:"application/vnd.visio",wad:"application/x-doom",wasm:"application/wasm",wav:"audio/wav",wax:"audio/x-ms-wax",wbmp:"image/vnd.wap.wbmp",wbxml:"application/vnd.wap.wbxml",webm:"video/webm",wk:"application/x-123",wm:"video/x-ms-wm",wma:"audio/x-ms-wma",wmd:"application/x-ms-wmd",wml:"text/vnd.wap.wml",wmlc:"application/vnd.wap.wmlc",wmls:"text/vnd.wap.wmlscript",wmlsc:"application/vnd.wap.wmlscriptc",wmv:"video/x-ms-wmv",wmx:"video/x-ms-wmx",wmz:"application/x-ms-wmz",woff:"application/font-woff",wp5:"application/vnd.wordperfect5.1",wpd:"application/vnd.wordperfect",wrl:"model/vrml",wsc:"text/scriptlet",wvx:"video/x-ms-wvx",wz:"application/x-wingz",x3d:"model/x3d+xml",x3db:"model/x3d+binary",x3dv:"model/x3d+vrml",xbm:"image/x-xbitmap",xcf:"application/x-xcf",xcos:"application/x-scilab-xcos",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xlam:"application/vnd.ms-excel.addin.macroEnabled.12",xlb:"application/vnd.ms-excel",xls:"application/vnd.ms-excel",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.12",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.12",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xlt:"application/vnd.ms-excel",xltm:"application/vnd.ms-excel.template.macroEnabled.12",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xml:"application/xml",xpi:"application/x-xpinstall",xpm:"image/x-xpixmap",xsd:"application/xml",xsl:"application/xslt+xml",xslt:"application/xslt+xml",xspf:"application/xspf+xml",xtel:"chemical/x-xtel",xul:"application/vnd.mozilla.xul+xml",xwd:"image/x-xwindowdump",xyz:"chemical/x-xyz",xz:"application/x-xz",zip:"application/zip"};function de(e){return new n.Transform({async transform(t,a,n){e(t.length),this.push(t),n()}})}function he(e,t){const a=de(t);return re(e,a,"createReadNReadStream")}let fe=null;fe={__proto__:null,CRC:class{constructor(){this.value="0"}reset(){this.value="0"}async updateBlob(){throw new w("Not implemented in node.js environment.")}update(e){return this.value=u.crc64(e,this.value),this.value}getCrc64(){return this.value}},combineCrc64:u.combineCrc64};const{CRC:me,combineCrc64:ye}=fe;function ge(e){return new n.Transform({async transform(t,a,n){try{const a=t.length;let o=!1;for(;!o;){const{ok:t,timeToWait:n}=await e.Acquire(a);t||await xe(n),o=t}this.push(t),n()}catch(e){n(e)}}})}function xe(e){return new Promise(t=>{setTimeout(()=>t(""),e)})}var be={__proto__:null,createDefaultRateLimiter:function(e,t){const a=Math.max(10240,e),n={rate:Math.max(1024,t),capacity:a,currentAmount:a,lastConsumeTime:Date.now()};return{Acquire:async e=>{e>n.capacity&&(e=n.capacity);const t=Date.now(),a=Math.floor((t-n.lastConsumeTime)/1e3*n.rate);return a+n.currentAmount>n.capacity?n.currentAmount=n.capacity:n.currentAmount+=a,e>n.currentAmount?{ok:!1,timeToWait:Math.ceil((e-n.currentAmount)/n.rate*1e3)}:(n.lastConsumeTime=t,n.currentAmount=n.currentAmount-e,{ok:!0,timeToWait:0})}}},createRateLimiterStream:function(e,t){const a=ge(t);return re(e,a,"createRateLimiterStream")},wait:xe};let ke=null;ke=be;const{createDefaultRateLimiter:ve,createRateLimiterStream:Te}=ke;class we extends n.Readable{constructor(e){super(),this.buf=void 0,this.lastPos=0,this.buf=e}_read(e){const t=this.buf.length;let a=Math.min(e,t-this.lastPos);this.lastPos>=t?this.push(null):(this.push(this.buf.slice(this.lastPos,this.lastPos+a)),this.lastPos+=a)}}function Se(e){return new n.Transform({async transform(t,a,n){e(t),this.push(t),n()}})}function Ee(e,t){const a=Se(e=>t.update(e));return re(e,a,"createCrcReadStream")}var Ce;function Pe(e){if(("string"==typeof e?e:e.key).length<1)throw new w("invalid object name, the length must be greater than 1")}function Re(e,t){if(q(e))return e.length;if(K(e))return e.size;if(t&&t["content-length"]){const e=+t["content-length"];if(e>=0)return e}return null}async function Be(e){const t=function({body:e,dataTransferCallback:t,makeRetryStream:a,rateLimiter:n}){let o=e;if(q(o)){const e=o;a=()=>new we(e),o=new we(e)}if(G(o)&&(n&&Ae(n)&&(o=Te(o,n)),o=he(o,t),a)){const e=a;return{body:o,makeRetryStream:()=>{let a=e();return a?(n&&Ae(n)&&(a=Te(a,n)),a=he(a,t),a):a}}}return{body:o,makeRetryStream:void 0}}(e);return async function({body:e,beforeRetry:t,makeRetryStream:a,enableCRC:n}){if(!n)return{body:e,beforeRetry:t,makeRetryStream:a};let o=e;const i=new me;if(G(e)&&(o=Ee(e,i),a)){const e=a;a=()=>{const t=e();return t?Ee(t,i):t}}return{body:o,beforeRetry:()=>{i.reset(),null==t||t()},makeRetryStream:a,crc:i}}(e={...e,...t})}function Ie(e,t){return`/${e}/${encodeURIComponent(t)}`}function Ae(e){if(!(null!=e&&e.Acquire&&(null==e?void 0:e.Acquire)instanceof Function))throw new w("The rateLimiter is not valid function");return!0}function Oe(e){"object"==typeof e&&console.warn("The `checkpoint` parameter should be passed as a string in node.js environment, representing a file or directory.Passing a checkpoint object to it will be removed in the future.")}!function(e){e.HeaderRestore="x-tos-restore",e.HeaderRestoreExpiryDays="x-tos-restore-expiry-days",e.HeaderRestoreRequestDate="x-tos-restore-request-date",e.HeaderRestoreTier="x-tos-restore-tier",e.HeaderProjectName="x-tos-project-name",e.HeaderReplicationStatus="x-tos-replication-status"}(Ce||(Ce={}));const Me=e=>{if(!e)return;const t=null==e?void 0:e[Ce.HeaderRestore];if(t){var a,n,o;const r=null!=(a=null==(n=(null!=t?t:"").split('",')[1])||null==n.split||null==(o=n.split("="))?void 0:o[1])?a:"",c='ongoing-request="true"'===(null==t?void 0:t.trim()),s={RestoreStatus:{OngoingRequest:c,ExpiryDate:r}};var i;return c&&(s.RestoreParam={ExpiryDays:e[Ce.HeaderRestoreExpiryDays]?Number(e[Ce.HeaderRestoreExpiryDays]):0,RequestDate:null!=(i=e[Ce.HeaderRestoreRequestDate])?i:"",Tier:e[Ce.HeaderRestoreTier]}),s}};var De;(De=exports.DataTransferType||(exports.DataTransferType={}))[De.Started=1]="Started",De[De.Rw=2]="Rw",De[De.Succeed=3]="Succeed",De[De.Failed=4]="Failed";const je=function(e,t){if(q(e))throw new w("not support buffer in browser environment");return function(e,t){return t?e.toString(function(e){switch(e){case"utf-8":return m;case"base64":return h;case"hex":return f;default:throw new w("The coding is not supported")}}(t)):e}(d(e),t)};function _e(e,t){return t?e.digest(t):e.digest()}let Le=null;Le={__proto__:null,hmacSha256:function(e,t,a){return _e(y.createHmac("sha256",e).update(t),a)},hashSha256:function(e,t){return _e(y.createHash("sha256").update(e),t)},hashMd5:function(e,t){return _e(y.createHash("md5").update(e),t)},parse:function(e,t){return Buffer.from(e,t)},stringify:function(e,t){return e.toString(t)}};const{hmacSha256:Ue,hashSha256:Ne,hashMd5:ze,parse:Fe,stringify:Ke}=Le;async function qe(e){const{uploadId:t,partNumber:a,body:n,enableContentMD5:o=!1}=e,i=N(e.headers);e.headers=i,Q(e,["trafficLimit","ssecAlgorithm","ssecKey","ssecKeyMD5"]);const r=Re(n);if(r&&null==i["content-length"]&&(i["content-length"]=r.toFixed(0)),o&&null==i["content-md5"])if(G(n)&&e.makeRetryStream){const t=e.makeRetryStream();if(t){let e=Buffer.from([]);for await(const a of t)e=Buffer.concat([e,"string"==typeof a?Buffer.from(a):a]);const a=ze(e,"base64");i["content-md5"]=a}}else console.warn("current not support enableMD5Checksum");const c=Re(e.body,i),s=null!=c;s||!e.dataTransferStatusChange&&!e.progress||console.warn("Don't get totalSize of uploadPart's body, the `dataTransferStatusChange` callback will not trigger. You can use `uploadPartFromFile` instead");let l=0;const{dataTransferStatusChange:p,progress:u}=e,d=(e,t=0)=>{if(!s||t<0)return;if(!p&&!u)return;l+=t,null==p||p({type:e,rwOnceBytes:t,consumedBytes:l,totalBytes:c});const a=0===c?e===exports.DataTransferType.Succeed?1:0:l/c;1===a?e===exports.DataTransferType.Succeed&&(null==u||u(a)):null==u||u(a)},h=await Be({body:e.body,dataTransferCallback:e=>d(exports.DataTransferType.Rw,e),beforeRetry:e.beforeRetry,makeRetryStream:e.makeRetryStream,enableCRC:this.opts.enableCRC,rateLimiter:e.rateLimiter});d(exports.DataTransferType.Started);const[f,m]=await F((async()=>{const n=await this._fetchObject(e,"PUT",{partNumber:a,uploadId:t},i,h.body,{handleResponse:e=>({partNumber:a,ETag:e.headers.etag,serverSideEncryption:e.headers["x-tos-server-side-encryption"],serverSideDataEncryption:e.headers["x-tos-server-side-data-encryption"],serverSideEncryptionKeyId:e.headers["x-tos-server-side-encryption-kms-key-id"],ssecAlgorithm:e.headers["x-tos-server-side-encryption-customer-algorithm"],ssecKeyMD5:e.headers["x-tos-server-side-encryption-customer-key-MD5"],hashCrc64ecma:e.headers["x-tos-hash-crc64ecma"]}),axiosOpts:{__retryConfig__:{beforeRetry:()=>{l=0,null==h.beforeRetry||h.beforeRetry()},makeRetryStream:h.makeRetryStream},onUploadProgress:e=>{d(exports.DataTransferType.Rw,e.loaded-l)}}});return this.opts.enableCRC&&h.crc&&Z(h.crc,n.headers),n})());if(f||!m)throw d(exports.DataTransferType.Failed),f;return d(exports.DataTransferType.Succeed),m}async function Ge(e){return qe.call(this,e)}async function $e(e){var t,a;const n=await R(e.filePath),o=null!=(t=e.offset)?t:0,i=Math.min(n.size,o+(null!=(a=e.partSize)?a:n.size)),r=oe(()=>C(e.filePath,{start:o,end:i-1}));try{return await qe.call(this,{...e,body:r.make(),headers:{...e.headers||{},"content-length":""+(i-o)},makeRetryStream:r.make})}catch(e){throw ie(r.getLastStream(),e),e}}async function He(e){var t;e.headers=null!=(t=e.headers)?t:{},Q(e,["callback","callbackVar","forbidOverwrite"]);const a=t=>{const a=t.headers,n={VersionID:a["x-tos-version-id"],ETag:a.etag,Bucket:e.bucket||this.opts.bucket||"",Location:a.location,HashCrc64ecma:a["x-tos-hash-crc64ecma"],Key:e.key,...t.data};return e.callback&&(n.CallbackResult=""+JSON.stringify(t.data)),n};if(e.completeAll){var n;if((null==(n=e.parts)?void 0:n.length)>0)throw new w("Should not specify both 'completeAll' and 'parts' params.");return this._fetchObject(e,"POST",{uploadId:e.uploadId},{...e.headers,"x-tos-complete-all":"yes"},void 0,{handleResponse:a})}return this._fetchObject(e,"POST",{uploadId:e.uploadId},{...e.headers},{Parts:e.parts.map(e=>({ETag:e.eTag,PartNumber:e.partNumber}))},{handleResponse:a})}class We extends n.Readable{_read(){this.push(null)}}var Ve;(Ve=exports.UploadEventType||(exports.UploadEventType={}))[Ve.CreateMultipartUploadSucceed=1]="CreateMultipartUploadSucceed",Ve[Ve.CreateMultipartUploadFailed=2]="CreateMultipartUploadFailed",Ve[Ve.UploadPartSucceed=3]="UploadPartSucceed",Ve[Ve.UploadPartFailed=4]="UploadPartFailed",Ve[Ve.UploadPartAborted=5]="UploadPartAborted",Ve[Ve.CompleteMultipartUploadSucceed=6]="CompleteMultipartUploadSucceed",Ve[Ve.CompleteMultipartUploadFailed=7]="CompleteMultipartUploadFailed";const Je=[403,404,405];async function Qe(e){var t,a,n;const{cancelToken:o,enableContentMD5:i=!1}=e,r=N(e.headers);e.headers=r,Q(e,["encodingType","cacheControl","contentDisposition","contentEncoding","contentLanguage","contentType","expires","acl","grantFullControl","grantRead","grantReadAcp","grantWriteAcp","ssecAlgorithm","ssecKey","ssecKeyMD5","serverSideEncryption","serverSideDataEncryption","meta","websiteRedirectLocation","storageClass"]);const c=()=>o&&!!o.reason;Oe(e.checkpoint);const s=await(async()=>"string"==typeof e.file?R(e.file):null)(),l=await(async()=>{const{file:t}=e;if(s)return s.size;if(q(t))return t.length;if(K(t))return t.size;throw new w("`file` must be string, Buffer, File or Blob")})(),p=await(async()=>{if("string"==typeof e.checkpoint){const{checkpoint:t}=e;let a=null;try{a=await R(t)}catch(e){const t=e;if("ENOENT"!==t.code)throw t}const n=a?a.isDirectory():t.endsWith("/"),o=n?g.resolve(t,"@@checkpoint-file-placeholder@@"):g.resolve(t),i=g.dirname(o);if(await O(i),n)return{filePath:o,filePathIsPlaceholder:!0};try{return{filePath:o,filePathIsPlaceholder:!1,record:a?await ne(o):void 0}}catch(e){throw console.warn("the checkpoint file is invalid JSON format. please check checkpoint file"),e}}return"object"==typeof e.checkpoint?{record:e.checkpoint}:{}})();await(async()=>{var e;if(s&&null!=(e=p.record)&&e.file_info){var t;const{last_modified:e,file_size:a}=null==(t=p.record)?void 0:t.file_info;s.mtimeMs===e&&s.size===a||(console.warn(`The file has been modified since ${new Date(e)}, so the checkpoint file is invalid, and specified file will be uploaded again.`),delete p.record)}})();const u=le(l,e.partSize||(null==(t=p.record)?void 0:t.part_size)||20971520,!0);p.record&&p.record.part_size!==u&&(console.warn("The partSize param does not equal the partSize in checkpoint file, so the checkpoint file is invalid, and specified file will be uploaded again."),delete p.record);let d=e.bucket||this.opts.bucket||"";const h=e.key;let f="",m=[];const y=function(e,t){const a=[];for(let n=0;;++n){const o=n*t,i=Math.min(t,e-o);if(a.push({offset:o,partSize:i,partNumber:n+1}),(n+1)*t>=e)break}return a}(l,u),x=((null==(a=p.record)?void 0:a.parts_info)||[]).filter(e=>e.is_completed).reduce((e,t)=>e+t.part_size,0);let b=x;const k=(null==(n=p.record)?void 0:n.parts_info)||[],v=new Map;k.forEach(e=>v.set(e.part_number,e));const E=()=>{const e={bucket:d,key:h,part_size:u,upload_id:f,parts_info:k};return s&&(e.file_info={last_modified:s.mtimeMs,file_size:s.size}),e},C=t=>{if(!e.uploadEventChange)return;const a={bucket:d,uploadId:f,key:h,...t};p.filePath&&(a.checkpointFile=p.filePath),e.uploadEventChange(a)};let P;!function(e){e[e.start=1]="start",e[e.uploadPartSucceed=2]="uploadPartSucceed",e[e.completeMultipartUploadSucceed=3]="completeMultipartUploadSucceed"}(P||(P={}));const A=t=>{e.progress&&(b===l&&t===P.uploadPartSucceed||e.progress(t===P.start&&0===l?0:l?b/l:1,E()))};let D=x;const{dataTransferStatusChange:j}=e,_=(e,t=0)=>{j&&(D+=t,null==j||j({type:e,rwOnceBytes:t,consumedBytes:D,totalBytes:l}))},L=ae(async()=>{if(p.filePath){const e=JSON.stringify(E(),null,2),t=g.dirname(p.filePath);await O(t),await B(p.filePath,e,"utf-8")}}),U=async(e,t)=>{let a=v.get(e.partNumber);a||(a={part_number:e.partNumber,offset:e.offset,part_size:e.partSize,is_completed:!1,etag:"",hash_crc64ecma:""},k.push(a),v.set(a.part_number,a)),t.err||(a.is_completed=!0,a.etag=t.res.ETag,a.hash_crc64ecma=t.res.hashCrc64ecma),await L();const n={partNumber:a.part_number,partSize:a.part_size,offset:a.offset};if(t.err){const e=t.err;let a=exports.UploadEventType.UploadPartFailed;return e instanceof T&&Je.includes(e.statusCode)&&(a=exports.UploadEventType.UploadPartAborted),void C({type:a,err:e,uploadPartInfo:n})}n.etag=t.res.ETag,b+=n.partSize,C({type:exports.UploadEventType.UploadPartSucceed,uploadPartInfo:n}),A(P.uploadPartSucceed)};if(p.record){d=p.record.bucket,f=p.record.upload_id;const e=new Set((p.record.parts_info||[]).filter(e=>e.is_completed).map(e=>e.part_number));m=y.filter(t=>!e.has(t.partNumber))}else{try{const{data:t}=await se.call(this,e);if(c())throw new S("cancel uploadFile");var z;d=t.Bucket,f=t.UploadId,p.filePathIsPlaceholder&&(p.filePath=null==(z=p.filePath)?void 0:z.replace("@@checkpoint-file-placeholder@@",function(e,t){return`${t}.${ze(`${e}.${t}`,"hex")}.upload`.replace(/[\\/]/g,"")}(d,h))),C({type:exports.UploadEventType.CreateMultipartUploadSucceed})}catch(e){const t=e;throw C({type:exports.UploadEventType.CreateMultipartUploadFailed,err:t}),t}m=y}A(P.start),_(exports.DataTransferType.Started);const[G,$]=await F((async()=>{let t=null,a=0;if(await Promise.all(Array.from({length:e.taskNum||1}).map(async()=>{let n=void 0,o=0,s=null,l=null;try{for(;;){var p;const l=a++;if(l>=m.length)return;function u(e,t){const{offset:a,partSize:o}=t,i=a+o;if(n)return n.make();if(K(e))return e.slice(a,i);if(q(e))return e.slice(a,i);throw new w("`file` must be string, Buffer, File or Blob")}s=m[l],n=Xe(e.file,s);const{data:y}=await qe.call(this,{bucket:d,key:h,uploadId:f,body:u(e.file,s),enableContentMD5:i,makeRetryStream:null==(p=n)?void 0:p.make,beforeRetry:()=>{D-=o,o=0},partNumber:s.partNumber,headers:{"content-length":""+s.partSize,"x-tos-server-side-encryption-customer-algorithm":r["x-tos-server-side-encryption-customer-algorithm"],"x-tos-server-side-encryption-customer-key":r["x-tos-server-side-encryption-customer-key"],"x-tos-server-side-encryption-customer-key-md5":r["x-tos-server-side-encryption-customer-key-md5"]},dataTransferStatusChange(e){e.type===exports.DataTransferType.Rw&&(c()||t||(o+=e.rwOnceBytes,_(e.type,e.rwOnceBytes)))},trafficLimit:e.trafficLimit,rateLimiter:e.rateLimiter});if(c())throw new S("cancel uploadFile");if(t)throw new S("cancel uploadFile by internal error(`firstErr`)");await U(s,{res:y})}}catch(e){l=e,t||(t=l)}try{var y;l?s&&await U(s,{err:l}):(ie(null==(y=n)?void 0:y.getLastStream(),l),D-=o,o=0)}catch(e){M("error while clearing resources of `uploadFile` task, err:",e)}})),t)throw t;const n=(E().parts_info||[]).map(e=>({eTag:e.etag,partNumber:e.part_number})),[o,s]=await F(He.call(this,{bucket:d,key:h,uploadId:f,parts:n}));if(o||!s)throw C({type:exports.UploadEventType.CompleteMultipartUploadFailed}),o;if(C({type:exports.UploadEventType.CompleteMultipartUploadSucceed}),A(P.completeMultipartUploadSucceed),await(async()=>{p.filePath&&await I(p.filePath).catch(e=>{console.warn("remove checkpoint file failure, you can remove it by hand.\n",`checkpoint file path: ${p.filePath}\n`,e.message)})})(),this.opts.enableCRC&&s.data.HashCrc64ecma&&function(e){var t,a,n;const o=(null==(t=e.file_info)?void 0:t.file_size)||0;let i="0";const r=null!=(a=null==(n=e.parts_info)||null==n.sort?void 0:n.sort((e,t)=>e.part_number-t.part_number))?a:[];for(const e of r)i=ye(i,e.hash_crc64ecma,Math.min(e.part_size,o-e.offset));return i}(E())!==s.data.HashCrc64ecma)throw new w("crc of entire file mismatch.");return s})());if(G||!$)throw _(exports.DataTransferType.Failed),G;return _(exports.DataTransferType.Succeed),$}function Xe(e,t){const{offset:a,partSize:n}=t,o=a+n;if("string"==typeof e)return oe(()=>n?C(e,{start:a,end:o-1}):new We)}var Ye,Ze,et,tt,at,nt,ot,it,rt,ct,st,lt,pt,ut,dt,ht,ft,mt,yt,gt,xt,bt,kt,vt,Tt,wt;async function St(e){const t="string"==typeof e?{key:e}:e,a=N(t.headers);t.headers=a;const n={};return t.versionId&&(n.versionId=t.versionId),Q(t,["ifMatch","ifModifiedSince","ifNoneMatch","ifUnmodifiedSince","ssecAlgorithm","ssecKey","ssecKeyMD5"]),this._fetchObject(e,"HEAD",n,(null==t?void 0:t.headers)||{},void 0,{handleResponse:e=>{const t={...e.headers,ReplicationStatus:e.headers[Ce.HeaderReplicationStatus]},a=Me(e.headers);return a&&(t.RestoreInfo=a),t}})}async function Et(e){const{uploadId:t,partNumber:a}=e,n=N(e.headers);if(e.headers=n,Q(e,["copySourceRange","copySourceSSECAlgorithm","copySourceSSECKey","copySourceSSECKeyMD5","ssecAlgorithm","ssecKey","ssecKeyMD5","trafficLimit"]),e.srcBucket&&e.srcKey){var o;let t=Ie(e.srcBucket,e.srcKey);e.srcVersionID&&(t+="?versionId="+e.srcVersionID),n["x-tos-copy-source"]=null!=(o=n["x-tos-copy-source"])?o:t}if(null==e.copySourceRange&&(null!=e.copySourceRangeStart||null!=e.copySourceRangeEnd)){var i;const t=`bytes=${null!=e.copySourceRangeStart?""+e.copySourceRangeStart:""}-${null!=e.copySourceRangeEnd?""+e.copySourceRangeEnd:""}`;n["x-tos-copy-source-range"]=null!=(i=n["x-tos-copy-source-range"])?i:t}const[r,c]=await F(this._fetchObject(e,"PUT",{partNumber:a,uploadId:t},n,void 0,{handleResponse:e=>({...e.data,SSECAlgorithm:e.headers[V.ssecAlgorithm],SSECKeyMD5:e.headers[V.ssecKeyMD5]})}));if(r||!c||!c.data.ETag)throw r;return c}async function Ct(e){const t=N(e.headers);if(e.headers=t,Q(e,["cacheControl","contentDisposition","contentEncoding","contentLanguage","contentType","expires","copySourceIfMatch","copySourceIfModifiedSince","copySourceIfNoneMatch","copySourceIfUnmodifiedSince","copySourceSSECAlgorithm","copySourceSSECKey","copySourceSSECKeyMD5","acl","grantFullControl","grantRead","grantReadAcp","grantWriteAcp","ssecAlgorithm","ssecKey","ssecKeyMD5","serverSideEncryption","metadataDirective","meta","websiteRedirectLocation","storageClass","trafficLimit","forbidOverwrite","ifMatch"]),e.srcBucket&&e.srcKey){var a;let n=Ie(e.srcBucket,e.srcKey);e.srcVersionID&&(n+="?versionId="+e.srcVersionID),t["x-tos-copy-source"]=null!=(a=t["x-tos-copy-source"])?a:n}const[n,o]=await F(this._fetchObject(e,"PUT",{},t));if(n||!o||!o.data.ETag)throw n;return o}(Ye=exports.ACLType||(exports.ACLType={})).ACLPrivate="private",Ye.ACLPublicRead="public-read",Ye.ACLPublicReadWrite="public-read-write",Ye.ACLAuthenticatedRead="authenticated-read",Ye.ACLBucketOwnerRead="bucket-owner-read",Ye.ACLBucketOwnerFullControl="bucket-owner-full-control",Ye.ACLBucketOwnerEntrusted="bucket-owner-entrusted",Ye.ACLDefault="default",(Ze=exports.StorageClassType||(exports.StorageClassType={})).StorageClassStandard="STANDARD",Ze.StorageClassIa="IA",Ze.StorageClassArchiveFr="ARCHIVE_FR",Ze.StorageClassColdArchive="COLD_ARCHIVE",Ze.StorageClassIntelligentTiering="INTELLIGENT_TIERING",Ze.StorageClassArchive="ARCHIVE",(et=exports.MetadataDirectiveType||(exports.MetadataDirectiveType={})).MetadataDirectiveCopy="COPY",et.MetadataDirectiveReplace="REPLACE",(tt=exports.AzRedundancyType||(exports.AzRedundancyType={})).AzRedundancySingleAz="single-az",tt.AzRedundancyMultiAz="multi-az",(at=exports.PermissionType||(exports.PermissionType={})).PermissionRead="READ",at.PermissionWrite="WRITE",at.PermissionReadAcp="READ_ACP",at.PermissionWriteAcp="WRITE_ACP",at.PermissionFullControl="FULL_CONTROL",at.PermissionReadNONLIST="READ_NON_LIST",(nt=exports.GranteeType||(exports.GranteeType={})).GranteeGroup="Group",nt.GranteeUser="CanonicalUser",(ot=exports.CannedType||(exports.CannedType={})).CannedAllUsers="AllUsers",ot.CannedAuthenticatedUsers="AuthenticatedUsers",(it=exports.HttpMethodType||(exports.HttpMethodType={})).HttpMethodGet="GET",it.HttpMethodPut="PUT",it.HttpMethodPost="POST",it.HttpMethodDelete="DELETE",it.HttpMethodHead="HEAD",(rt=exports.StorageClassInheritDirectiveType||(exports.StorageClassInheritDirectiveType={})).StorageClassInheritDirectiveDestinationBucket="DESTINATION_BUCKET",rt.StorageClassInheritDirectiveSourceObject="SOURCE_OBJECT",(ct=exports.ReplicationStatusType||(exports.ReplicationStatusType={})).Complete="COMPLETE",ct.Pending="PENDING",ct.Failed="FAILED",ct.Replica="REPLICA",(st=exports.LifecycleStatusType||(exports.LifecycleStatusType={})).Enabled="Enabled",st.Disabled="Disabled",(lt=exports.RedirectType||(exports.RedirectType={})).Mirror="Mirror",lt.Async="Async",(pt=exports.StatusType||(exports.StatusType={})).Enabled="Enabled",pt.Disabled="Disabled",(ut=exports.TierType||(exports.TierType={})).TierStandard="Standard",ut.TierExpedited="Expedited",ut.TierBulk="Bulk",(dt=exports.VersioningStatusType||(exports.VersioningStatusType={})).Enabled="Enabled",dt.Suspended="Suspended",dt.NotSet="",dt.Enable="Enabled",dt.Disable="",(ht=exports.AccessPointStatusType||(exports.AccessPointStatusType={})).Ready="READY",ht.Creating="CREATING",ht.Created="CREATED",ht.Deleting="DELETING",(ft=exports.TransferAccelerationStatusType||(exports.TransferAccelerationStatusType={})).Activating="AccelerationActivating",ft.Activated="AccelerationActivated",ft.Terminated="AccelerationTerminated",(mt=exports.MRAPMirrorBackRedirectPolicyType||(exports.MRAPMirrorBackRedirectPolicyType={})).ClosestFirst="Closest-First",mt.LatestFirst="Latest-First",(yt=exports.WorkflowExecutionStateType||(exports.WorkflowExecutionStateType={})).Success="Success",yt.Running="Running",yt.Submitted="Submitted",yt.Failed="Failed",(gt=exports.FileCompressFlatten||(exports.FileCompressFlatten={}))[gt.KeepStructure=0]="KeepStructure",gt[gt.FlattenAll=1]="FlattenAll",gt[gt.PrefixAsDirectory=2]="PrefixAsDirectory",gt[gt.PrefixContentsOnly=3]="PrefixContentsOnly",(xt=exports.FileUncompressPrefixReplaced||(exports.FileUncompressPrefixReplaced={}))[xt.NoExtraPrefix=0]="NoExtraPrefix",xt[xt.WithArchiveName=1]="WithArchiveName",xt[xt.FullArchivePath=2]="FullArchivePath",(bt=exports.AccessPointStatus||(exports.AccessPointStatus={})).Enable="enable",bt.Disable="disable",bt.Creating="creating",bt.Deleting="deleting",(kt=exports.AcceleratorPrefetchJobStatus||(exports.AcceleratorPrefetchJobStatus={})).Null="NULL",kt.Idle="IDLE",kt.Running="RUNNING",kt.Stopping="STOPPING",kt.Complete="COMPLETE",(vt=exports.AuditJobStateType||(exports.AuditJobStateType={})).Submitted="Submitted",vt.Running="Running",vt.Success="Success",vt.Failed="Failed",vt.Paused="Paused",vt.Canceled="Canceled",(Tt=exports.AuditScanType||(exports.AuditScanType={})).Manifest="Manifest",Tt.Scan="Scan",(wt=exports.ResumableCopyEventType||(exports.ResumableCopyEventType={}))[wt.CreateMultipartUploadSucceed=1]="CreateMultipartUploadSucceed",wt[wt.CreateMultipartUploadFailed=2]="CreateMultipartUploadFailed",wt[wt.UploadPartCopySucceed=3]="UploadPartCopySucceed",wt[wt.UploadPartCopyFailed=4]="UploadPartCopyFailed",wt[wt.UploadPartCopyAborted=5]="UploadPartCopyAborted",wt[wt.CompleteMultipartUploadSucceed=6]="CompleteMultipartUploadSucceed",wt[wt.CompleteMultipartUploadFailed=7]="CompleteMultipartUploadFailed";const Pt=[403,404,405];async function Rt(e){var t,a,n;const{cancelToken:o}=e,i=()=>o&&!!o.reason;Oe(e.checkpoint);const{data:r}=await St.call(this,{bucket:e.srcBucket,key:e.srcKey,versionId:e.srcVersionId}),c=r.etag,s=+r["content-length"],l=await(async()=>{if("string"==typeof e.checkpoint){const{checkpoint:t}=e;let a=null;try{a=await R(t)}catch(e){const t=e;if("ENOENT"!==t.code)throw t}const n=a?a.isDirectory():t.endsWith("/"),o=n?g.resolve(t,"@@checkpoint-file-placeholder@@"):g.resolve(t),i=g.dirname(o);return await O(i),n?{filePath:o,filePathIsPlaceholder:!0}:{filePath:o,filePathIsPlaceholder:!1,record:a?await ne(o):void 0}}return"object"==typeof e.checkpoint?{record:e.checkpoint}:{}})();await(async()=>{var e;if(null!=(e=l.record)&&e.copy_source_object_info){var t;const{last_modified:e,object_size:a}=null==(t=l.record)?void 0:t.copy_source_object_info;r["last-modified"]===e&&+r["content-length"]===a||(console.warn(`The file has been modified since ${new Date(e)}, so the checkpoint file is invalid, and specified file will be uploaded again.`),delete l.record)}})();const p=le(s,e.partSize||(null==(t=l.record)?void 0:t.part_size)||20971520,!0);l.record&&l.record.part_size!==p&&(console.warn("The partSize param does not equal the partSize in checkpoint file, so the checkpoint file is invalid, and specified file will be uploaded again."),delete l.record);let u=e.bucket||this.opts.bucket||"";const d=e.key;let h="",f=[];const m=function(e,t){const a=[];for(let n=0;;++n){const o=n*t,i=Math.min(t,e-o);if(a.push({offset:o,partSize:i,partNumber:n+1}),(n+1)*t>=e)break}return a}(s,p);let y=((null==(a=l.record)?void 0:a.parts_info)||[]).filter(e=>e.is_completed).reduce((e,t)=>e+t.copy_source_range_end-t.copy_source_range_start+1,0);const b=(null==(n=l.record)?void 0:n.parts_info)||[],k=new Map;b.forEach(e=>k.set(e.part_number,e));const v=()=>({bucket:u,key:d,part_size:p,upload_id:h,parts_info:b,copy_source_object_info:{last_modified:r["last-modified"],etag:r.etag,hash_crc64ecma:r["x-tos-hash-crc64ecma"]||"",object_size:+r["content-length"]}}),E=t=>{if(!e.copyEventListener)return;const a={bucket:u,uploadId:h,key:d,...t};l.filePath&&(a.checkpointFile=l.filePath),e.copyEventListener(a)};let C;!function(e){e[e.start=1]="start",e[e.uploadPartSucceed=2]="uploadPartSucceed",e[e.completeMultipartUploadSucceed=3]="completeMultipartUploadSucceed"}(C||(C={}));const P=t=>{e.progress&&(y===s&&t===C.uploadPartSucceed||e.progress(t===C.start&&0===s?0:s?y/s:1,v()))},A=ae(async()=>{if(l.filePath){const e=JSON.stringify(v(),null,2),t=g.dirname(l.filePath);await O(t),await B(l.filePath,e,"utf-8")}}),M=async(e,t)=>{let a=k.get(e.partNumber);const n=e.offset,o=Math.min(e.offset+p-1,s-1);a||(a={part_number:e.partNumber,copy_source_range_start:n,copy_source_range_end:o,is_completed:!1,etag:""},b.push(a),k.set(a.part_number,a)),t.err||(a.is_completed=!0,a.etag=t.res.ETag),await A();const i={partNumber:a.part_number,copySourceRangeEnd:a.copy_source_range_end,copySourceRangeStart:a.copy_source_range_start};if(t.err){const e=t.err;let a=exports.ResumableCopyEventType.UploadPartCopyFailed;return e instanceof T&&Pt.includes(e.statusCode)&&(a=exports.ResumableCopyEventType.UploadPartCopyAborted),void E({type:a,err:e,copyPartInfo:i})}i.etag=t.res.ETag,y+=i.copySourceRangeEnd-i.copySourceRangeStart+1,E({type:exports.ResumableCopyEventType.UploadPartCopySucceed,copyPartInfo:i}),P(C.uploadPartSucceed)};if(l.record){u=l.record.bucket,h=l.record.upload_id;const e=new Set((l.record.parts_info||[]).filter(e=>e.is_completed).map(e=>e.part_number));f=m.filter(t=>!e.has(t.partNumber))}else{try{const{data:t}=await se.call(this,x(e));if(i())throw new S("cancel uploadFile");var D;u=t.Bucket,h=t.UploadId,l.filePathIsPlaceholder&&(l.filePath=null==(D=l.filePath)?void 0:D.replace("@@checkpoint-file-placeholder@@",[(j={...e,bucket:u}).srcBucket,j.srcKey,j.srcVersionId,j.bucket,j.key,"copy"].filter(Boolean).join(".").replace(/[\\/]/g,""))),E({type:exports.ResumableCopyEventType.CreateMultipartUploadSucceed})}catch(e){const t=e;throw E({type:exports.ResumableCopyEventType.CreateMultipartUploadFailed,err:t}),t}f=m}var j;return P(C.start),0===s?(async()=>{let t=Ie(e.srcBucket,e.srcKey);e.srcVersionId&&(t+="?versionId="+e.srcVersionId);const a={...e.headers,"x-tos-copy-source":t,"x-tos-copy-source-if-match":c},[n,o]=await F(Ct.call(this,{bucket:e.bucket,key:e.key,headers:a,trafficLimit:e.trafficLimit}));if(n||!o)throw E({type:exports.ResumableCopyEventType.UploadPartCopyFailed}),n;return P(C.completeMultipartUploadSucceed),E({type:exports.ResumableCopyEventType.UploadPartCopySucceed,copyPartInfo:{partNumber:0,copySourceRangeStart:0,copySourceRangeEnd:0}}),E({type:exports.ResumableCopyEventType.CompleteMultipartUploadSucceed}),{...o,data:{ETag:o.headers.etag||"",Bucket:u,Key:d,Location:`http${this.opts.secure?"s":""}://${u}.${this.opts.endpoint}/${d}`,VersionID:o.headers["x-tos-version-id"],HashCrc64ecma:o.headers["x-tos-hash-crc64ecma"]}}})():(async()=>{let t=null,a=0;if(await Promise.all(Array.from({length:e.taskNum||1}).map(async()=>{for(;;){const n=a++;if(n>=f.length)return;const o=f[n];try{let t=Ie(e.srcBucket,e.srcKey);e.srcVersionId&&(t+="?versionId="+e.srcVersionId);const a=`bytes=${o.offset}-${o.offset+o.partSize-1}`,n={...e.headers,"x-tos-copy-source":t,"x-tos-copy-source-if-match":c,"x-tos-copy-source-range":a};o.partSize||delete n["x-tos-copy-source-range"];const{data:r}=await Et.call(this,{bucket:u,key:d,uploadId:h,partNumber:o.partNumber,headers:n,trafficLimit:e.trafficLimit});if(i())throw new S("cancel resumableCopyObject");await M(o,{res:r})}catch(e){const a=e;if(Bt(a))throw a;if(i())throw new S("cancel resumableCopyObject");t||(t=a),await M(o,{err:a})}}})),t)throw t;const n=(v().parts_info||[]).map(e=>({eTag:e.etag,partNumber:e.part_number})),[o,r]=await F(He.call(this,{bucket:u,key:d,uploadId:h,parts:n}));if(o||!r)throw E({type:exports.ResumableCopyEventType.CompleteMultipartUploadFailed}),o;E({type:exports.ResumableCopyEventType.CompleteMultipartUploadSucceed}),P(C.completeMultipartUploadSucceed);const s=v().copy_source_object_info.hash_crc64ecma,p=r.data.HashCrc64ecma;if(this.opts.enableCRC&&s&&p&&s!==p)throw new w(`validate file crc64 failed. Expect crc64 ${s}, actual crc64 ${p}. Please try again.`);return await(async()=>{l.filePath&&await I(l.filePath).catch(e=>{console.warn("remove checkpoint file failure, you can remove it by hand.\n",`checkpoint file path: ${l.filePath}\n`,e.message)})})(),r})()}function Bt(e){return e instanceof S}async function It(e){const t="string"==typeof e?{key:e}:e,a={};t.versionId&&(a.versionId=t.versionId);const n=N(null==t?void 0:t.headers),o=(null==t?void 0:t.response)||{};return Object.keys(o).forEach(e=>{const t=o[e];null!=t&&(a["response-"+e]=t)}),this._fetchObject(e,"GET",a,n,void 0,{axiosOpts:{responseType:"arraybuffer"}})}const At=["stream","buffer"];async function Ot(e){const t="string"==typeof e?{key:e}:e,a=N(t.headers);t.headers=a;const n=t.dataType||"stream";t.dataType=n,function(e){let t="node",a=[];if(t="node",a=At,!a.includes(e))throw new w(`The value of \`dataType\` only supports \`${a.join(" | ")}\` in node environment`)}(n);const o={},i=(null==t?void 0:t.response)||{};if(Object.keys(i).forEach(e=>{const t=i[e];null!=t&&(o["response-"+e]=t)}),function(e,t,a){function n(e,a){null==t[e]&&(t[e]=a)}a.length&&a.forEach(t=>{const a=J[t];if(!a)throw new w(`\`${t}\` isn't in keys of \`requestQueryMap\``);const o=e[t];if(null==o)return;if("string"==typeof a)return n(a,""+o);if(Array.isArray(a))return n(a[0],a[1](o));const i=a(o);Object.entries(i).forEach(([e,t])=>{n(e,t)})})}(t,o,["versionId","process","saveBucket","saveObject","responseCacheControl","responseContentDisposition","responseContentEncoding","responseContentLanguage","responseContentType","responseExpires"]),Q(t,["ifMatch","ifModifiedSince","ifNoneMatch","ifUnmodifiedSince","ssecAlgorithm","ssecKey","ssecKeyMD5","range","trafficLimit"]),null==t.range&&(null!=t.rangeStart||null!=t.rangeEnd)){var r;const e=`bytes=${null!=t.rangeStart?""+t.rangeStart:""}-${null!=t.rangeEnd?""+t.rangeEnd:""}`;a.range=null!=(r=a.range)?r:e}let c=0,s=-1;const{dataTransferStatusChange:l,progress:p}=t,u=(e,t=0)=>{if(t<0)return;if(!l&&!p)return;c+=t,null==l||l({type:e,rwOnceBytes:t,consumedBytes:c,totalBytes:s});const a=s<0?0:0===s?e===exports.DataTransferType.Succeed?1:0:c/s;1===a?e===exports.DataTransferType.Succeed&&(null==p||p(a)):null==p||p(a)};u(exports.DataTransferType.Started);const[d,h]=await F(this._fetchObject(e,"GET",o,a,void 0,{axiosOpts:{responseType:"stream",onDownloadProgress:e=>{s=e.total,u(exports.DataTransferType.Rw,e.loaded-c)}}}));if(d||!h)throw u(exports.DataTransferType.Failed),d;let f=h.headers,m=h.data;s=+(f["content-length"]||0),G(m)&&(t.rateLimiter&&Ae(t.rateLimiter)&&(m=Te(m,t.rateLimiter)),m=he(m,e=>u(exports.DataTransferType.Rw,e)),m.on("end",()=>u(exports.DataTransferType.Succeed)),"buffer"===n&&(m=await(async e=>{let t=Buffer.from([]);return new Promise((a,n)=>{e.on("data",e=>{t=Buffer.concat([t,e])}),e.on("end",()=>{a(t)}),e.on("error",e=>{n(e)})})})(m)));const y={...h,data:{content:m,etag:f.etag||"",lastModified:f["last-modified"]||"",hashCrc64ecma:f["x-tos-hash-crc64ecma"]||"",ReplicationStatus:f[Ce.HeaderReplicationStatus]}},g=Me(f);return g&&(y.data.RestoreInfo=g),y}async function Mt(e){return new Promise(async(t,a)=>{const n=await Ot.call(this,e),o=n.data.content,i=E(e.filePath);o.pipe(i),o.on("error",e=>i.destroy(e)),i.on("error",e=>a(e)),i.on("finish",()=>{const e={...n.data};delete e.content,t({...n,data:{...e}})})})}var Dt;(Dt=exports.DownloadEventType||(exports.DownloadEventType={}))[Dt.CreateTempFileSucceed=1]="CreateTempFileSucceed",Dt[Dt.CreateTempFileFailed=2]="CreateTempFileFailed",Dt[Dt.DownloadPartSucceed=3]="DownloadPartSucceed",Dt[Dt.DownloadPartFailed=4]="DownloadPartFailed",Dt[Dt.DownloadPartAborted=5]="DownloadPartAborted",Dt[Dt.RenameTempFileSucceed=6]="RenameTempFileSucceed",Dt[Dt.RenameTempFileFailed=7]="RenameTempFileFailed";const jt=[403,404,405];async function _t(e){var t,a,n,o;const{cancelToken:i,versionId:r}=e,c=()=>i&&!!i.reason;Oe(e.checkpoint);const s=await St.call(this,{bucket:e.bucket,key:e.key,versionId:r}),{data:l}=s,p=l.etag,u=null!=(t=l["x-tos-symlink-target-size"])?t:0,d="Symlink"===l["x-tos-object-type"]?+u:+l["content-length"],h=await(async()=>{if("string"==typeof e.checkpoint){const{checkpoint:t}=e;let a=null;try{a=await R(t)}catch(e){const t=e;if("ENOENT"!==t.code)throw t}const n=a?a.isDirectory():t.endsWith("/"),o=n?g.resolve(t,"@@checkpoint-file-placeholder@@"):t,i=g.dirname(o);return await O(i),n?{filePath:o,filePathIsPlaceholder:!0}:{filePath:o,filePathIsPlaceholder:!1,record:a?await ne(o):void 0}}return"object"==typeof e.checkpoint?{record:e.checkpoint}:{}})();await(async()=>{var e;if(null!=(e=h.record)&&e.object_info){var t;const{last_modified:e,object_size:a}=null==(t=h.record)?void 0:t.object_info;l["last-modified"]===e&&d===a||(console.warn(`The file has been modified since ${new Date(e)}, so the checkpoint file is invalid, and specified object will be downloaded again.`),delete h.record)}})();const f=e.partSize||(null==(a=h.record)?void 0:a.part_size)||20971520;h.record&&h.record.part_size!==f&&(console.warn("The partSize param does not equal the partSize in checkpoint file, so the checkpoint file is invalid, and specified object will be downloaded again."),delete h.record);let m=e.bucket||this.opts.bucket||"";const y=e.key,x=await(async()=>{let t=null;try{t=await R(e.filePath)}catch(e){const t=e;if("ENOENT"!==t.code)throw t}const a=(t?t.isDirectory():e.filePath.endsWith("/"))?g.resolve(e.filePath,y):e.filePath,n=g.dirname(a);return await O(n),a})(),[b,k]=await(async()=>{const t=e.tempFilePath?e.tempFilePath:x+".temp";let a=!0;try{await R(t)}catch(e){const t=e;if("ENOENT"!==t.code)throw t;a=!1}return[t,a]})();h.record&&(k||(console.warn("The temp file doesn't not exist so the checkpoint file is invalid, and specified object will be downloaded again."),delete h.record));let v=[];const C=function(e,t){const a=[];for(let n=0;;++n){const o=n*t,i=Math.min(t,e-o);if(a.push({offset:o,partSize:i,partNumber:n+1}),(n+1)*t>=e)break}return a}(d,f),A=((null==(n=h.record)?void 0:n.parts_info)||[]).filter(e=>e.is_completed).reduce((e,t)=>e+(t.range_end-t.range_start+1),0),M=(null==(o=h.record)?void 0:o.parts_info)||[],D=new Map;M.forEach(e=>D.set(e.part_number,e));const j=async()=>{const t=()=>({bucket:m,key:y,version_id:r,part_size:f,parts_info:M,file_info:{file_path:x,temp_file_path:b},object_info:{last_modified:l["last-modified"],etag:p,hash_crc64ecma:l["x-tos-hash-crc64ecma"]||"",object_size:d}}),a=t=>{if(!e.downloadEventChange)return;const a={bucket:m,versionId:r,key:y,filePath:x,...t};h.filePath&&(a.checkpointFile=h.filePath),e.downloadEventChange(a)};let n,o=A;!function(e){e[e.start=0]="start",e[e.downloadPartSucceed=1]="downloadPartSucceed",e[e.renameTempFileSucceed=2]="renameTempFileSucceed"}(n||(n={}));const i=a=>{e.progress&&(o===d&&a===n.downloadPartSucceed||e.progress(a===n.start&&0===d?0:d?o/d:1,t()))};let u=A;const{dataTransferStatusChange:k}=e,R=(e,t=0)=>{k&&(u+=t,null==k||k({type:e,rwOnceBytes:t,consumedBytes:u,totalBytes:d}))},j=ae(async()=>{if(h.filePath){const e=JSON.stringify(t(),null,2),a=g.dirname(h.filePath);await O(a),await B(h.filePath,e,"utf-8")}}),_=async(e,t)=>{let r=D.get(e.partNumber);const c=e.offset,s=Math.min(e.offset+f-1,d-1);r||(r={part_number:e.partNumber,range_start:c,range_end:s,hash_crc64ecma:"",is_completed:!1},M.push(r),D.set(r.part_number,r)),t.err||(r.is_completed=!0,r.hash_crc64ecma=t.res.rangeHashCrc64ecma),await j();const l={partNumber:r.part_number,rangeStart:c,rangeEnd:s};if(t.err){const e=t.err;let n=exports.DownloadEventType.DownloadPartFailed;return e instanceof T&&jt.includes(e.statusCode)&&(n=exports.DownloadEventType.DownloadPartAborted),void a({type:n,err:e,downloadPartInfo:l})}o+=l.rangeEnd-l.rangeStart+1,a({type:exports.DownloadEventType.DownloadPartSucceed,downloadPartInfo:l}),i(n.downloadPartSucceed)};if(h.record){m=h.record.bucket;const e=new Set((h.record.parts_info||[]).filter(e=>e.is_completed).map(e=>e.part_number));v=C.filter(t=>!e.has(t.partNumber))}else{try{await B(b,"",{flag:"w+"})}catch(e){const t=e;throw a({type:exports.DownloadEventType.CreateTempFileFailed,err:t}),t}var L;h.filePathIsPlaceholder&&(h.filePath=null==(L=h.filePath)?void 0:L.replace("@@checkpoint-file-placeholder@@",function(e,t,a){return`${e}_${t}.${a}.json`.replace(/[\\/]/g,"")}(m,y,r))),a({type:exports.DownloadEventType.CreateTempFileSucceed}),R(exports.DataTransferType.Started),v=C}i(n.start),0===d?await(async()=>{})():await(async()=>{let a=null,n=0;if(await Promise.all(Array.from({length:e.taskNum||1}).map(async()=>{for(;;){const t=n++;if(t>=v.length)return;const o=v[t];let i=0;try{const t=await Ot.call(this,{bucket:m,key:y,versionId:r,headers:{"if-match":p,range:`bytes=${o.offset}-${Math.min(o.offset+o.partSize-1,d-1)}`},trafficLimit:e.trafficLimit,rateLimiter:e.rateLimiter,dataTransferStatusChange(e){e.type===exports.DataTransferType.Rw&&(c()||(i+=e.rwOnceBytes,R(exports.DataTransferType.Rw,e.rwOnceBytes)))}});let a=t.data.content;const n=new me;if(this.opts.enableCRC&&(a=Ee(a,n)),await new Promise((e,t)=>{const n=E(b,{start:o.offset,flags:"r+"});let i=!1,r=null;n.on("close",()=>{i?t(r):e(void 0)}),n.on("error",e=>{i=!0,r=e}),a.pipe(n),a.on("error",e=>n.destroy(e)),a.on("data",(function e(){c()&&(t(new S("cancel downloadFile")),n.end(),a.unpipe(n),a.off("data",e))}))}),c())throw new S("cancel downloadFile");await _(o,{res:{...t.data,rangeHashCrc64ecma:n.getCrc64()}})}catch(e){const t=e;if(u-=i,i=0,H(t))throw t;if(c())throw new S("cancel downloadFile");a||(a=t),await _(o,{err:t})}}})),a)throw a;const o=s.data["x-tos-hash-crc64ecma"];if(this.opts.enableCRC&&o){const e=function(e){var t,a;let n="0";const o=null!=(t=null==(a=e.parts_info)||null==a.sort?void 0:a.sort((e,t)=>e.part_number-t.part_number))?t:[];for(const e of o)n=ye(n,e.hash_crc64ecma,e.range_end-e.range_start+1);return n}(t());if(e!==o)throw new w(`validate file crc64 failed. Expect crc64 ${o}, actual crc64 ${e}. Please try again.`)}})();try{"function"==typeof e.customRenameFileAfterDownloadCompleted?await e.customRenameFileAfterDownloadCompleted(b,x):await P(b,x)}catch(e){const t=e;throw a({type:exports.DownloadEventType.RenameTempFileFailed,err:t}),R(exports.DataTransferType.Failed),t}return a({type:exports.DownloadEventType.RenameTempFileSucceed}),i(n.renameTempFileSucceed),R(exports.DataTransferType.Succeed),await(async()=>{h.filePath&&await I(h.filePath).catch(e=>{console.warn("remove checkpoint file failure, you can remove it by hand.\n",`checkpoint file path: ${h.filePath}\n`,e.message)})})(),s};try{return await j()}finally{}}function Lt(e){return!e||80===e||443===e}const Ut="request";class Nt{constructor(e,t){this.options=void 0,this.credentials=void 0,this.signature=(e,t,a)=>{a||(a=this.credentials);const n=[],o=this.credentialString(e.datetime);return n.push(this.options.algorithm+" Credential="+a.GetAccessKey()+"/"+o),n.push("SignedHeaders="+this.signedHeaders(e)),n.push("Signature="+this.authorization(e,a,0)),n.join(", ")},this.signatureHeader=(e,t,a)=>{e.datetime=this.getDateTime();const n=new Map;e.headers||(e.headers={}),e.headers.host=""+e.host,Lt(e.port)||(e.headers.host+=":"+e.port),e.endpoints&&(e.headers.host=`${this.options.bucket}.${e.endpoints}`),n.set("host",e.headers.host),n.set("x-tos-date",e.datetime),n.set("x-tos-content-sha256",this.hexEncodedBodyHash()),this.options.securityToken&&n.set("x-tos-security-token",this.options.securityToken),n.forEach((t,a)=>{a.startsWith("x-tos")&&(e.headers[a]=t)}),e.path=this.getEncodePath(e.path);const o=this.signature(e,0,a);return n.set("authorization",o),n},this.gnrCopySig=(e,t)=>({key:"",value:""}),this.getSignature=(e,t)=>({key:"",value:""}),this.getSignatureQuery=(e,t)=>{e.datetime=this.getDateTime(),e.headers||(e.headers={}),e.headers.host=""+e.host,Lt(e.port)||(e.headers.host+=":"+e.port),e.path=this.getEncodePath(e.path),e.endpoints&&(e.headers.host=`${this.options.bucket}.${e.endpoints}`),e.headers["X-Tos-Date"]=e.datetime;const a=this.credentialString(e.datetime),n={...e.query||{},"X-Tos-Algorithm":this.options.algorithm,"X-Tos-Content-Sha256":this.hexEncodedBodyHash(),"X-Tos-Credential":this.credentials.GetAccessKey()+"/"+a,"X-Tos-Date":e.datetime,"X-Tos-Expires":""+t,"X-Tos-SignedHeaders":this.signedHeaders(e)};return this.options.securityToken&&(n["X-Tos-Security-Token"]=this.options.securityToken),e.query=U(n),n["X-Tos-Signature"]=this.authorization(e,this.credentials,t),n},this.getSignaturePolicyQuery=(e,t)=>{e.datetime=this.getDateTime();const a=this.credentialString(e.datetime),n={"X-Tos-Algorithm":this.options.algorithm,"X-Tos-Credential":this.credentials.GetAccessKey()+"/"+a,"X-Tos-Date":e.datetime,"X-Tos-Expires":""+t,"X-Tos-Policy":Ke(Fe(JSON.stringify(e.policy),"utf-8"),"base64")};return this.options.securityToken&&(n["X-Tos-Security-Token"]=this.options.securityToken),e.query=U(n),n["X-Tos-Signature"]=this.authorization(e,this.credentials,t),n},this.hexEncodedBodyHash=()=>"UNSIGNED-PAYLOAD",this.authorization=(e,t,a)=>{if(!e.datetime)return"";const n=this.getSigningKey(t,e.datetime.substr(0,8));return Ue(n,this.stringToSign(e.datetime,e),"hex")},this.getDateTime=()=>new Date((new Date).toUTCString()).toISOString().replace(/\..+/,"").replace(/-/g,"").replace(/:/g,"")+"Z",this.credentialString=e=>this.createScope(e.substr(0,8),this.options.region,this.options.serviceName),this.createScope=(e,t,a)=>[e.substr(0,8),t,a,Ut].join("/"),this.getSigningKey=(e,t)=>{const a=Ue(e.GetSecretKey(),t),n=Ue(a,this.options.region),o=Ue(n,this.options.serviceName);return Ue(o,Ut)},this.stringToSign=(e,t)=>{if(!this.options.algorithm)return"";const a=[];a.push(this.options.algorithm),a.push(e),a.push(this.credentialString(e));const n="policy"in t?this.canonicalStringPolicy(t):this.canonicalString(t);return a.push(this.hexEncodedHash(n)),a.join("\n")},this.hexEncodedHash=e=>Ne(e,"hex"),this.canonicalString=e=>{const t=[];return t.push(e.method),t.push(e.path),t.push(this.getEncodePath(e.query,!1)),t.push(this.canonicalHeaders(e)+"\n"),t.push(this.signedHeaders(e)),t.push(this.hexEncodedBodyHash()),t.join("\n")},this.canonicalStringPolicy=e=>{const t=[];return t.push(this.getEncodePath(e.query,!1)),t.push(this.hexEncodedBodyHash()),t.join("\n")},this.canonicalHeaders=e=>{const t=[],a=Ft(e.headers);for(let n of a){const a=e.headers[n];n=n.toLowerCase(),t.push(n+":"+this.canonicalHeaderValues(a.toString()))}return t.join("\n")},this.canonicalHeaderValues=e=>e.replace(/\s+/g," ").replace(/^\s+|\s+$/g,""),this.signedHeaders=e=>{const t=[],a=Ft(e.headers);for(let e of a)e=e.toLowerCase(),t.push(e);return t.sort().join(";")},this.options=e,this.credentials=t}getEncodePath(e,t=!0){if(!e)return"";let a=e;return t&&(a=e.replace(/%2F/g,"/")),a=a.replace(/\(/g,"%28"),a=a.replace(/\)/g,"%29"),a=a.replace(/!/g,"%21"),a=a.replace(/\*/g,"%2A"),a=a.replace(/\'/g,"%27"),a}}class zt{constructor(e,t,a){this.securityToken=void 0,this.secretAccessKey=void 0,this.accessKeyId=void 0,this.accessKeyId=a,this.secretAccessKey=t,this.securityToken=e}GetAccessKey(){return this.accessKeyId}GetSecretKey(){return this.secretAccessKey}}function Ft(e){const t=[];return Object.keys(e||{}).forEach(a=>{("host"===a||a.startsWith("x-tos-"))&&null!=e[a]&&t.push(a)}),t.sort()}function Kt(e){const{tosOpts:t,...a}=e,n=new(t.isHttps?k.Agent:b.Agent)({...a,keepAlive:!0,rejectUnauthorized:t.enableVerifySSL,timeout:t.idleConnectionTime});n.maxFreeSockets=Infinity,n.maxTotalSockets=t.maxConnections;const o=n.createConnection;return n.createConnection=function(...e){const a=o.call(this,...e);let n=!1,i=!1,r=null;return process.nextTick(()=>{i||(r=setTimeout(()=>{n=!0},t.connectionTimeout))}),a.on("connect",()=>{i=!0,r&&clearTimeout(r),n&&a.destroy(new Error("Connect timeout"))}),a},n}class qt{constructor(e){this.opts=void 0,this.axiosInst=void 0,this.userAgent=void 0,this.httpAgent=void 0,this.httpsAgent=void 0,this.getObjectPath=e=>{const t="string"!=typeof e&&e.bucket||this.opts.bucket,a="string"==typeof e?e:e.key;if(!t)throw new w("Must provide bucket param");return`/${t}/${encodeURIComponent(a)}`},this.setObjectContentTypeHeader=(e,t)=>{if(null!=t["content-type"])return;let a="application/octet-stream";const n=(e=>"string"==typeof e?e:e.key)(e);this.opts.autoRecognizeContentType&&(a=function(e){const t=e.lastIndexOf(".");if(t<=0)return;const a=e.slice(t+1).toLowerCase();return ue[a]}(n)||a),a&&(t["content-type"]=a)},this.getNormalDataFromError=Y,this.opts=this.normalizeOpts(e),this.httpAgent=Kt({tosOpts:{...this.opts,isHttps:!1}}),this.httpsAgent=Kt({tosOpts:{...this.opts,isHttps:!this.opts.proxyHost}}),this.userAgent=this.getUserAgent(),this.axiosInst=(e=>{const t=a.create();t.defaults.auth=void 0,t.defaults.responseType="json",t.defaults.params=void 0,t.defaults.headers={},t.defaults.withCredentials=!1,t.defaults.maxContentLength=-1,t.defaults.maxBodyLength=-1,t.defaults.maxRedirects=0,t.defaults.validateStatus=function(e){return e>=200&&e<300},t.defaults.decompress=!1,t.defaults.transitional={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};const o=e=>{var t;return e.headers=e.headers||e.header||(null==e||null==(t=e.response)?void 0:t.headers)||{},e};function i(e){Object.entries(e).forEach(([t,a])=>{const[n,o]=function(e){try{return[null,decodeURI(a)]}catch(e){return[e,null]}}();if(n||null==o||o===a)return;let i=[];const r=(""+a).match(/./gu),c=o.match(/./gu);for(let e=0,t=0;e<c.length;){const a=c[e];if(a===r[t]){i.push(a),++e,++t;continue}const n=encodeURIComponent(a);a.length>1||a.charCodeAt(0)>=128?i.push(a):i.push(n),++e,t+=n.length}e[t]=i.join("")})}return t.interceptors.response.use(o,e=>(o(e),Promise.reject(e))),t.interceptors.response.use(e=>e.headers?(i(e.headers),e):e,async e=>{var t;if(!a.isAxiosError(e))return Promise.reject(e);const n=null==(t=e.response)?void 0:t.headers;return n?(i(n),Promise.reject(e)):Promise.reject(e)}),t.interceptors.response.use(void 0,async a=>{var o;const{config:i}=a;if(!i)return Promise.reject(a);i.__retryConfig__||(i.__retryConfig__={});const r=i.__retryConfig__,c=null!=(o=r.retryCount)?o:0;let s=i.data;const l=(()=>{if(i.data&&i.data instanceof n.Readable){const e=null==r.makeRetryStream?void 0:r.makeRetryStream();if(!e)return!1;s=e}return!0})();if(!((function(e){var t;return!e.response&&Boolean(e.code)||e.response&&!(null!=(t=e.response.headers)&&t["x-tos-request-id"])}(a)||function(e){if(!e.response)return!1;const{status:t}=e.response;return 429===t||408===t||t>=500}(a))&&c<e&&l))return Promise.reject(a);const p=i.__retrySignature__;if(p){const{signOpt:e,sigInst:t}=p;t.signatureHeader(e).forEach((e,t)=>{i.headers[t]=e})}M("retryConfig: ",i);const u={...i,data:s,__retryConfig__:{...r,retryCount:c+1}};return null==r.beforeRetry||r.beforeRetry(),t(u)}),t})(this.opts.maxRetryCount)}normalizeOpts(e){var t;["accessKeyId","accessKeySecret","stsToken","region","endpoint"].forEach(t=>{const a=e[t];"string"==typeof a&&(e[t]=a.trim())});const a=["accessKeyId","accessKeySecret","region"].filter(t=>!e[t]).join(", ");if(a)throw new w(`lack params: ${a}.`);const n=e.endpoint||`tos-${e.region}.volces.com`;if(!n)throw new w("the value of param region is invalid, correct values are cn-beijing, cn-nantong etc.");if(n.includes("s3"))throw new w("do not support s3 endpoint, please use tos endpoint.");const o=null==e.secure||!!e.secure,i=(e,t)=>null==e?t:e;return{...e,endpoint:n,secure:o,enableVerifySSL:i(e.enableVerifySSL,!0),autoRecognizeContentType:i(e.autoRecognizeContentType,!0),requestTimeout:i(e.requestTimeout,12e4),connectionTimeout:i(e.connectionTimeout,1e4),maxConnections:i(e.maxConnections,1024),idleConnectionTime:i(e.idleConnectionTime,3e4),maxRetryCount:i(e.maxRetryCount,3),enableCRC:null!=(t=e.enableCRC)&&t,requestAdapter:void 0}}getUserAgent(){const e=(()=>{const e=v.type();return{Linux:"linux",Darwin:"darwin",Windows_NT:"windows"}[e]||e})(),t=process.version.replace("v","");return[`ve-tos-nodejs-sdk/v2.7.5 (${e}/${process.arch};nodejs${t})`,(()=>{const{userAgentProductName:e,userAgentSoftName:t,userAgentSoftVersion:a}=this.opts;let n=Object.entries(this.opts.userAgentCustomizedKeyValues||{}).map(([e,t])=>`${e}/${t}`).join(";");return n=n?`(${n})`:"",e||t||a||n?[[e,t,a].map(e=>e||"undefined").join("/"),n].filter(Boolean).join(" "):""})()].filter(Boolean).join(" -- ")}async fetch(e,t,n,o,i,r){const c=(null==r?void 0:r.handleResponse)||(e=>e.data);if(i&&(null==r?void 0:r.needMd5)){const e=ze(JSON.stringify(i),"base64");o["content-md5"]=e}const[s,l]=(()=>null!=r&&r.subdomainBucket&&this.opts.forcePathStyle?[this.opts.endpoint,`/${r.subdomainBucket}${t}`]:null!=r&&r.subdomainBucket&&!this.opts.isCustomDomain?/^(\d|:)/.test(this.opts.endpoint)?[this.opts.endpoint,`/${r.subdomainBucket}${t}`]:[`${null==r?void 0:r.subdomainBucket}.${this.opts.endpoint}`,t]:[this.opts.endpoint,t])();t=l,o=(e=>{const t={};return Object.entries(e).forEach(([e,a])=>{t[e]=(""+a).match(/./gu).map(e=>e.length>1||e.charCodeAt(0)>=128?encodeURIComponent(e):e).join("")}),t})(o);const p={endpoints:void 0,bucket:"",method:e,headers:{...o},path:t,query:U(n),host:s},u=new zt(this.opts.stsToken,this.opts.accessKeySecret,this.opts.accessKeyId),d=new Nt({algorithm:"TOS4-HMAC-SHA256",region:this.opts.region,serviceName:"tos",bucket:"",securityToken:this.opts.stsToken},u),h=d.signatureHeader(p),f={...o},m={method:e,baseURL:`http${this.opts.secure?"s":""}://${s}`,url:t,params:n,headers:f,data:i||""};h.forEach((e,t)=>{m.headers[t]=e});const y=z(this.opts.proxy);if(null!=y&&y.url&&!this.opts.proxyHost)m.baseURL=y.url,null!=y&&y.needProxyParams&&(m.params["x-proxy-tos-host"]=s,delete f.host);else if(this.opts.proxyHost){if(!this.opts.proxyPort)throw new w("The `proxyPort` is required if `proxyHost` is truly.");m.proxy={host:this.opts.proxyHost,port:this.opts.proxyPort,protocol:"http"}}f["user-agent"]=this.userAgent,this.opts.requestTimeout>0&&Infinity!==this.opts.requestTimeout&&(m.timeout=this.opts.requestTimeout),m.httpAgent=this.httpAgent,m.httpsAgent=this.httpsAgent;try{const e={...m};delete e.httpAgent,delete e.httpsAgent,M("reqOpts: ",e);const t=await this.axiosInst({maxBodyLength:Infinity,maxContentLength:Infinity,adapter:this.opts.requestAdapter,...m,...(null==r?void 0:r.axiosOpts)||{},__retrySignature__:{signOpt:p,sigInst:d}});return{data:c(t),statusCode:t.status,headers:t.headers,requestId:t.headers["x-tos-request-id"],id2:t.headers["x-tos-id-2"]}}catch(e){var g,x;if(a.isAxiosError(e)&&null!=(g=e.response)&&null!=(x=g.headers)&&x["x-tos-request-id"]){const t=e.response;throw M("TosServerError response: ",t),new T(t)}throw M("err: ",e),e}}async fetchBucket(e,t,a,n,o,i){const r=e||this.opts.bucket;if(!r)throw new w("Must provide bucket param");return ce(r,this.opts.isCustomDomain),this.fetch(t,"/",a,n,o,{...i,subdomainBucket:r})}async _fetchObject(e,t,a,n,o,i){const r="string"!=typeof e&&e.bucket||this.opts.bucket,c="string"==typeof e?e:e.key;if(!r)throw new w("Must provide bucket param");return ce(r,this.opts.isCustomDomain),Pe(c),this.fetch(t,"/"+encodeURIComponent(c),a,n,o,{...i,subdomainBucket:r})}getSignatureQuery(e){const t=new zt(this.opts.stsToken,this.opts.accessKeySecret,this.opts.accessKeyId),a=new Nt({algorithm:"TOS4-HMAC-SHA256",region:this.opts.endpoint,serviceName:"tos",bucket:e.bucket,securityToken:this.opts.stsToken},t);return"policy"in e?a.getSignaturePolicyQuery({policy:e.policy},e.expires):a.getSignatureQuery({method:e.method,path:e.path,endpoints:e.subdomain?e.endpoint:void 0,host:e.endpoint,query:e.query},e.expires)}normalizeBucketInput(e){return"string"==typeof e?{bucket:e}:e}normalizeObjectInput(e){return"string"==typeof e?{key:e}:e}}async function Gt(e={}){const{...t}=e,a=await this.fetchBucket(e.bucket,"GET",_(t),{}),n=D(a.data);return n("CommonPrefixes"),n("Contents"),n("Versions"),n("DeleteMarkers"),a}async function $t(e={}){const{...t}=e,a=await this.fetchBucket(e.bucket,"GET",_({versions:"",...t}),{}),n=D(a.data);return n("CommonPrefixes"),n("Versions"),n("DeleteMarkers"),a}async function Ht(e={}){const{listOnlyOnce:t=!1}=e;let a;if(e.maxKeys||(e.maxKeys=1e3),t)a=await Wt.call(this,e);else{const t=e.maxKeys;let n={...e,maxKeys:t};for(;;){const e=await Wt.call(this,n);if(null==a?a=e:(a={...e,data:a.data},a.data.KeyCount+=e.data.KeyCount,a.data.IsTruncated=e.data.IsTruncated,a.data.NextContinuationToken=e.data.NextContinuationToken,a.data.Contents=a.data.Contents.concat(e.data.Contents),a.data.CommonPrefixes=a.data.CommonPrefixes.concat(e.data.CommonPrefixes)),!e.data.IsTruncated||a.data.KeyCount>=t)break;n.continuationToken=e.data.NextContinuationToken,n.maxKeys=n.maxKeys-e.data.KeyCount}}return a}async function Wt(e){const{...t}=e,a=await this.fetchBucket(e.bucket,"GET",{"list-type":2,..._(t)},{}),n=D(a.data);return n("CommonPrefixes"),n("Contents"),a}class Vt extends qt{modifyAxiosInst(){this.axiosInst.interceptors.request.use(e=>{const t=e.headers||{};return delete t.authorization,t.host=this.parsedPolicyUrlVal.host,e.baseURL=this.parsedPolicyUrlVal.origin,e.paramsSerializer=e=>{const t=X(e);return[this.parsedPolicyUrlVal.search,t].filter(e=>e.trim()).join("&")},e})}constructor(e){super({...e,bucket:"fake-bucket",region:"fake-region",accessKeyId:"fake-accessKeyId",accessKeySecret:"fake-accessKeySecret",endpoint:"fake-endpoint.com"}),this.shareLinkClientOpts=void 0,this.parsedPolicyUrlVal=void 0,this.headObject=St,this.getObjectV2=Ot,this.listObjects=Gt,this.listObjectsType2=Ht,this.listObjectVersions=$t,this.downloadFile=_t,this.shareLinkClientOpts=e,this.parsedPolicyUrlVal=this.initParsedPolicyUrlVal(),this.modifyAxiosInst()}initParsedPolicyUrlVal(){const e=this.shareLinkClientOpts.policyUrl.match(/(https?:\/\/(?:[^@]+@)?([^/?]+))[^?]*\?(.+)/);if(!e)throw new w("the `policyUrl` param is invalid");return{origin:e[1],host:e[2],search:e[3]}}}async function Jt(e={}){const t={};(null==e?void 0:e.projectName)&&Q({...e,headers:t},["projectName"]);const a=await this.fetch("GET","/",{},t);return D(a.data)("Buckets"),a}async function Qt(e){const t=e.bucket||this.opts.bucket;if(t){if(t.length<3||t.length>63)throw new w("invalid bucket name, the length must be [3, 63]");if(!/^([a-z]|-|\d)+$/.test(t))throw new w("invalid bucket name, the character set is illegal");if(/^-/.test(t)||/-$/.test(t))throw new w("invalid bucket name, the bucket name can be neither starting with '-' nor ending with '-'")}const a=e.headers=N(e.headers);return Q(e,["acl","grantFullControl","grantRead","grantReadAcp","grantWrite","grantWriteAcp","storageClass","azRedundancy","bucketType"]),(null==e?void 0:e.projectName)&&Q(e,["projectName"]),await this.fetchBucket(e.bucket,"PUT",{},a)}async function Xt(e){return this.fetchBucket(e,"DELETE",{},{})}async function Yt(e){return this.fetchBucket(e,"HEAD",{},{},void 0,{handleResponse:e=>({...e.headers,ProjectName:e.headers[Ce.HeaderProjectName]})})}async function Zt(e){const{bucket:t,storageClass:a}=e;return this.fetchBucket(t,"PUT",{storageClass:""},{"x-tos-storage-class":a})}async function ea(e){const t={};return e.acl&&(t["x-tos-acl"]=e.acl),await this.fetchBucket(e.bucket,"PUT",{acl:""},t,e.aclBody,{needMd5:!0})}async function ta(e){const t=await this.fetchBucket(e,"GET",{acl:""},{});return D(t.data)("Grants"),t}async function aa(e){const{bucket:t,TLS:a}=e;return await this.fetchBucket(t,"PUT",{httpsConfig:""},{},{TLS:a})}async function na(e){return await this.fetchBucket(e,"GET",{httpsConfig:""},{})}async function oa(e){return ia.call(this,e)}async function ia(e){const t=(e=this.normalizeObjectInput(e)).headers=N(e.headers);Q(e,["contentLength","contentMD5","contentSHA256","cacheControl","contentDisposition","contentEncoding","contentLanguage","contentType","expires","acl","grantFullControl","grantRead","grantReadAcp","grantWrite","grantWriteAcp","ssecAlgorithm","ssecKey","ssecKeyMD5","serverSideEncryption","serverSideDataEncryption","meta","websiteRedirectLocation","storageClass","trafficLimit","callback","callbackVar","forbidOverwrite","ifMatch"]),this.setObjectContentTypeHeader(e,t);const a=Re(e.body,t),n=null!=a;n||!e.dataTransferStatusChange&&!e.progress||console.warn("Don't get totalSize of putObject's body, the `dataTransferStatusChange` and `progress` callback will not trigger. You can use `putObjectFromFile` instead");let o=0;const{dataTransferStatusChange:i,progress:r}=e,c=(e,t=0)=>{if(!n||t<0)return;if(!i&&!r)return;o+=t,null==i||i({type:e,rwOnceBytes:t,consumedBytes:o,totalBytes:a});const c=0===a?e===exports.DataTransferType.Succeed?1:0:o/a;1===c?e===exports.DataTransferType.Succeed&&(null==r||r(c)):null==r||r(c)},s=await Be({body:e.body,dataTransferCallback:e=>c(exports.DataTransferType.Rw,e),makeRetryStream:e.makeRetryStream,enableCRC:this.opts.enableCRC,rateLimiter:e.rateLimiter});c(exports.DataTransferType.Started);const[l,p]=await F((async()=>{const a=await this._fetchObject(e,"PUT",{},t,s.body||"",{handleResponse:t=>{var a;const n={...t.headers};return null!=(a=e)&&a.callback&&t.data&&(n.CallbackResult=""+JSON.stringify(t.data)),n},axiosOpts:{__retryConfig__:{beforeRetry:()=>{o=0,null==s.beforeRetry||s.beforeRetry()},makeRetryStream:s.makeRetryStream},onUploadProgress:e=>{c(exports.DataTransferType.Rw,e.loaded-o)}}});return this.opts.enableCRC&&s.crc&&Z(s.crc,a.headers),a})());if(l||!p)throw c(exports.DataTransferType.Failed),l;return c(exports.DataTransferType.Succeed),p}async function ra(e){const t=N(e.headers);if(!t["content-length"]){const a=await R(e.filePath);t["content-length"]=""+a.size}const a=oe(()=>C(e.filePath));try{return await ia.call(this,{...e,body:a.make(),headers:t,makeRetryStream:a.make})}catch(e){throw ie(a.getLastStream(),e),e}}async function ca(e){const t=e.headers=N(e.headers);return Q(e,["acl","grantFullControl","grantRead","grantReadAcp","grantWriteAcp","ssecAlgorithm","ssecKey","ssecKeyMD5","meta","storageClass"]),await this._fetchObject(e,"POST",{fetch:""},t,{URL:e.url,IgnoreSameKey:e.ignoreSameKey,ContentMD5:e.contentMD5},{needMd5:!0})}async function sa(e){const t=e.headers=N(e.headers);return Q(e,["acl","grantFullControl","grantRead","grantReadAcp","grantWriteAcp","ssecAlgorithm","ssecKey","ssecKeyMD5","meta","storageClass"]),await this._fetchObject(e,"POST",{fetchTask:""},t,{URL:e.url,IgnoreSameKey:e.ignoreSameKey,ContentMD5:e.contentMD5,Object:e.key},{needMd5:!0})}function la(e){Pe(e);const t="string"==typeof e?{key:e}:e,a=t.alternativeEndpoint||this.opts.endpoint,n=!t.alternativeEndpoint&&!t.isCustomDomain,o=t.bucket||this.opts.bucket||"";if(n&&!o)throw new w("Must provide bucket param");const[i,r,c]=(()=>{const e=encodeURIComponent(t.key),i=t.key.split("/").map(e=>encodeURIComponent(e)).join("/");return n?[`${o}.${a}`,"/"+i,"/"+e]:[a,"/"+i,"/"+e]})(),s=t.query||{},l=(e,t)=>{null==s[e]&&null!=t&&(s[e]=t)},p=t.response||{};Object.keys(p).forEach(e=>{const t=e,a=_(t);l("response-"+a,p[t])}),t.versionId&&l("versionId",t.versionId);const u=this.getSignatureQuery({bucket:o,method:t.method||"GET",path:c,endpoint:a,subdomain:n,expires:t.expires||1800,query:s}),d=z(this.opts.proxy);let h=`http${this.opts.secure?"s":""}://${i}`;return null!=d&&d.url&&(h=d.url.replace(/\/+$/g,""),null!=d&&d.needProxyParams&&(u["x-proxy-tos-host"]=i)),`${h}${r}?${Object.keys(u).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(u[e])}`).join("&")}`}async function pa(e){const t="string"==typeof e?{key:e}:e,a={};return t.versionId&&(a.versionId=t.versionId),t.skipTrash&&(a.skipTrash=t.skipTrash),t.recursive&&(a.recursive=t.recursive),await this._fetchObject(e,"DELETE",a,{},{},{handleResponse:e=>e.headers})}async function ua(e){return e.headers=e.headers||{},Q(e,["recursiveMkdir","forbidOverwrite"]),this._fetchObject(e,"PUT",{rename:"",name:e.newKey},e.headers,"")}async function da(e){const t={Quiet:e.quiet,Objects:e.objects.map(e=>({Key:e.key,VersionId:e.versionId}))},a={delete:""};e.skipTrash&&(a.skipTrash=e.skipTrash),e.recursive&&(a.recursive=e.recursive);const n=await this.fetchBucket(e.bucket,"POST",a,{},t),o=D(n.data);return o("Deleted"),o("Error"),n}async function ha(e){const t="string"==typeof e?{key:e}:e,a={acl:""};t.versionId&&(a.versionId=t.versionId);const n=await this._fetchObject(e,"GET",a,{});return D(n.data)("Grants"),n}async function fa(e){const t=e.headers=N(e.headers),a={acl:""};return e.versionId&&(a.versionId=e.versionId),Q(e,["acl"]),this._fetchObject(e,"PUT",a,t,e.aclBody)}async function ma(e){return this._fetchObject(e,"DELETE",{uploadId:e.uploadId},{})}async function ya(e={}){const{...t}=e,a=await this.fetchBucket(e.bucket,"GET",{uploads:"",..._(t)},{}),n=D(a.data);return n("Uploads"),n("CommonPrefixes"),a}async function ga(e){const t=e=this.normalizeObjectInput(e),a=e.headers=N(e.headers);Q(e,["contentLength","cacheControl","contentDisposition","contentEncoding","contentLanguage","contentType","expires","acl","grantFullControl","grantRead","grantReadAcp","grantWriteAcp","meta","websiteRedirectLocation","storageClass","trafficLimit"]),this.setObjectContentTypeHeader(e,a);const n=Re(e.body,a),o=null!=n;if(!o)throw new w("appendObject needs to know the content length in advance");if(a["content-length"]=a["content-length"]||""+n,this.opts.enableCRC&&0!==e.offset&&!e.preHashCrc64ecma)throw new w("must provide preHashCrc64ecma if enableCRC is true and offset is non-zero");let i=0;const{dataTransferStatusChange:r,progress:c}=e,s=(e,t=0)=>{if(!o||t<0)return;if(!r&&!c)return;i+=t,null==r||r({type:e,rwOnceBytes:t,consumedBytes:i,totalBytes:n});const a=0===n?e===exports.DataTransferType.Succeed?1:0:i/n;1===a?e===exports.DataTransferType.Succeed&&(null==c||c(a)):null==c||c(a)},l=await Be({body:e.body,dataTransferCallback:e=>s(exports.DataTransferType.Rw,e),makeRetryStream:void 0,enableCRC:this.opts.enableCRC,rateLimiter:e.rateLimiter});s(exports.DataTransferType.Started);const[p,u]=await F((async()=>{const o=await this._fetchObject(e,"POST",{append:"",offset:t.offset},a,l.body||"",{handleResponse:e=>({...e.headers,nextAppendOffset:+e.headers["x-tos-next-append-offset"],hashCrc64ecma:e.headers["x-tos-hash-crc64ecma"]}),axiosOpts:{__retryConfig__:{beforeRetry:()=>{i=0,null==l.beforeRetry||l.beforeRetry()},makeRetryStream:l.makeRetryStream},onUploadProgress:e=>{s(exports.DataTransferType.Rw,e.loaded-i)}}});return this.opts.enableCRC&&l.crc&&Z(ye(t.preHashCrc64ecma||"0",l.crc.getCrc64(),n),o.headers),o})());if(p||!u)throw s(exports.DataTransferType.Failed),p;return s(exports.DataTransferType.Succeed),u}async function xa(e){const t="string"==typeof e?{key:e}:e,a=t.headers=N(t.headers);Q(t,["cacheControl","contentDisposition","contentEncoding","contentLanguage","contentType","expires","meta"]);const n={metadata:""};return t.versionId&&(n.versionId=t.versionId),this._fetchObject(e,"POST",n,a)}async function ba(e){Pe(e),e=this.normalizeObjectInput(e);const{expiresIn:t=3600,key:a}=e,n=e.bucket||this.opts.bucket,o={...e.fields},i=[...e.conditions||[]];if(!n)throw new w("Must provide bucket param");const r=this.opts.accessKeySecret,c=new Date,s=ka({date:new Date(c.valueOf()+1e3*t),type:"ISO"}),l=ka(),p=l.substring(0,8),u="tos",d="request",h=Ue(r,p),f=Ue(h,this.opts.region),m=Ue(f,u),y=Ue(m,d),g={key:a,"x-tos-algorithm":"TOS4-HMAC-SHA256","x-tos-date":l,"x-tos-credential":[this.opts.accessKeyId,p,this.opts.region,u,d].join("/")};this.opts.stsToken&&(g["x-tos-security-token"]=this.opts.stsToken),i.push({bucket:n}),Object.entries(g).forEach(([e,t])=>{o[e]=t}),Object.entries(o).forEach(([e,t])=>{i.push({[e]:""+t})});const x=JSON.stringify({expiration:s,conditions:i}),b=Ke(Fe(x,"utf-8"),"base64"),k=Ue(y,b,"hex");return o.policy=b,o["x-tos-signature"]=k,o}function ka(e){const{date:t=new Date,type:a="Z"}=e||{};return"ISO"===a?t.toISOString():t.toISOString().replace(/\..+/,"").replace(/-/g,"").replace(/:/g,"")+"Z"}const va={getBucketCustomDomain:!0,getBucketIntelligenttiering:!0,getBucketInventory:!0,listBucketInventory:!0,getBucketMirrorBack:!0,getBucketNotification:!0,getBucketPolicy:!0,getBucketRealTimeLog:!0,getBucketReplication:!0,getBucketTagging:!0,getBucketWebsite:!0};function Ta(e,t){const{enableCatchEmptyServerError:a,methodKey:n,defaultResponse:o}=t;if(e instanceof T)if(a){if(404===e.statusCode)return Y(o,e)}else if(void 0===a&&404===e.statusCode&&va[n])return Y(o,e);throw e}async function wa(e){return!this.opts.enableOptimizeMethodBehavior&&void 0!==this.opts.enableOptimizeMethodBehavior||e.policy.Statement.length?await this.fetchBucket(e.bucket,"PUT",{policy:""},{},e.policy,{needMd5:!0}):Ea.call(this,e.bucket)}async function Sa(e){try{const t=await this.fetchBucket(e,"GET",{policy:""},{});return t.data.Statement.forEach(e=>{const t=D(e);Object.keys(e.Condition||{}).forEach(a=>{Object.keys(e.Condition[a]).forEach(e=>{t(`Condition["${a}"]["${e}"]`)})})}),t}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketPolicy",defaultResponse:{Statement:[],Version:"2012-10-17"}})}}async function Ea(e){return this.fetchBucket(e,"DELETE",{policy:""},{})}async function Ca(e){return this.fetchBucket(e,"GET",{versioning:""},{})}async function Pa(e){return this.fetchBucket(e.bucket,"PUT",{versioning:""},{},{Status:e.status})}function Ra(e){const t=Ba.call(this,e);Ia(e.conditions);const a=`http${this.opts.secure?"s":""}://${e.alternativeEndpoint||(e.isCustomDomain?this.opts.endpoint:`${t.bucket}.${this.opts.endpoint}`)}`,n=$(this.getSignatureQuery({bucket:t.bucket,expires:t.expires,policy:{conditions:t.conditions}}));return{getSignedURLForList:e=>{const t=$(e),o=[n,t].filter(Boolean).join("&");return`${a}?${o}`},getSignedURLForGetOrHead:(e,t)=>{const o=$(t),i=[n,o].filter(Boolean).join("&"),r=e.split("/").map(e=>encodeURIComponent(e)).join("/");return`${a}/${r}?${i}`},signedQuery:n}}function Ba(e){const t=e.bucket||this.opts.bucket;if(!t)throw new w("Must provide bucket param");Ia(e.conditions);const a=e.conditions.map(e=>[e.operator||"eq","$key",e.value]);return a.push(["eq","$bucket",t]),{bucket:t,expires:e.expires||3600,conditions:a}}function Ia(e){if(e.length<1)throw new w("The `conditions` field of `PreSignedPolicyURLInput` must has one item at least");for(const t of e){if("key"!==t.key)throw new w("The `key` field of `PolicySignatureCondition` must be `'key'`");if(t.operator&&"eq"!==t.operator&&"starts-with"!==t.operator)throw new w("The `operator` field of `PolicySignatureCondition` must be `'eq'` or `'starts-with'`")}}async function Aa(e){const{bucket:t}=e;return this.fetchBucket(t,"GET",{location:""},{})}async function Oa(e){try{const{bucket:t}=e;return await this.fetchBucket(t,"GET",{cors:""},{})}catch(e){return Ta(e,{defaultResponse:{CORSRules:[]},enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketCORS"})}}async function Ma(e){const{bucket:t,CORSRules:a}=e;return this.opts.enableOptimizeMethodBehavior&&!a.length?Da.call(this,{bucket:t}):this.fetchBucket(t,"PUT",{cors:""},{},{CORSRules:a})}async function Da(e){const{bucket:t}=e;return this.fetchBucket(t,"DELETE",{cors:""},{})}async function ja(e){const{bucket:t,rules:a}=e;if(this.opts.enableOptimizeMethodBehavior&&!a.length)return La.call(this,{bucket:t});const n={};return Q({...e,headers:n},["allowSameActionOverlap"]),this.fetchBucket(t,"PUT",{lifecycle:""},n,{Rules:a})}async function _a(e){try{const{bucket:t}=e;return await this.fetchBucket(t,"GET",{lifecycle:""},{},{},{handleResponse:e=>({AllowSameActionOverlap:e.headers["x-tos-allow-same-action-overlap"],Rules:e.data.Rules})})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketLifecycle",defaultResponse:{Rules:[]}})}}async function La(e){const{bucket:t}=e;return this.fetchBucket(t,"DELETE",{lifecycle:""},{})}async function Ua(e){const{bucket:t,rule:a}=e;return this.fetchBucket(t,"PUT",{encryption:""},{"Content-MD5":je(JSON.stringify({Rule:a}),"base64")},{Rule:a})}async function Na(e){const{bucket:t}=e;return this.fetchBucket(t,"GET",{encryption:""},{})}async function za(e){const{bucket:t}=e;return this.fetchBucket(t,"DELETE",{encryption:""},{})}async function Fa(e){const{bucket:t,rules:a}=e;return this.opts.enableOptimizeMethodBehavior&&!a.length?qa.call(this,{bucket:t}):this.fetchBucket(t,"PUT",{mirror:""},{},{Rules:a})}async function Ka(e){const{bucket:t}=e;try{return await this.fetchBucket(t,"GET",{mirror:""},{})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketMirrorBack",defaultResponse:{Rules:[]}})}}async function qa(e){const{bucket:t}=e;return this.fetchBucket(t,"DELETE",{mirror:""},{})}async function Ga(e){const{tagSet:t,versionId:a}=e,n=N({versionId:a});return this._fetchObject(e,"PUT",{tagging:"",...n},{},{TagSet:t})}async function $a(e){const{versionId:t}=e,a=N({versionId:t}),n=await this._fetchObject(e,"GET",{tagging:"",...a},{});return D(n.data.TagSet)("Tags"),n}async function Ha(e){const{versionId:t}=e,a=N({versionId:t});return this._fetchObject(e,"DELETE",{tagging:"",...a},{})}async function Wa(e){const{bucket:t,rules:a,role:n}=e;return this.opts.enableOptimizeMethodBehavior&&!a.length?Ja.call(this,{bucket:t}):this.fetchBucket(t,"PUT",{replication:""},{},{Role:n,Rules:a})}async function Va(e){const{bucket:t,progress:a,ruleId:n}=e,o={replication:"",progress:a||""};null!=n&&(o["rule-id"]=""+n);try{return await this.fetchBucket(t,"GET",o,{})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketReplication",defaultResponse:{Rules:[],Role:""}})}}async function Ja(e){const{bucket:t}=e;return this.fetchBucket(t,"DELETE",{replication:""},{})}async function Qa(e){const{bucket:t,...a}=e,n=L(a);return this.fetchBucket(t,"PUT",{website:""},{},{...n})}async function Xa(e){const{bucket:t}=e;try{return this.fetchBucket(t,"GET",{website:""},{})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketWebsite",defaultResponse:{RoutingRules:[]}})}}async function Ya(e){const{bucket:t}=e;return this.fetchBucket(t,"DELETE",{website:""},{})}async function Za(e){const{bucket:t,...a}=e,n=L(a);return this.fetchBucket(t,"PUT",{notification:""},{},{...n})}async function en(e){const{bucket:t}=e;try{return await this.fetchBucket(t,"GET",{notification:""},{})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketNotification",defaultResponse:{CloudFunctionConfigurations:[],RocketMQConfigurations:[]}})}}async function tn(e){const{bucket:t,...a}=e,n=L(a);return this.fetchBucket(t,"PUT",{customdomain:""},{},{...n})}async function an(e){try{const{bucket:t}=e;return await this.fetchBucket(t,"GET",{customdomain:""},{})}catch(e){return Ta(e,{defaultResponse:{CustomDomainRules:[]},enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketCustomDomain"})}}async function nn(e){const{bucket:t,customDomain:a}=e;return this.fetchBucket(t,"DELETE",{customdomain:a},{})}async function on(e){const{bucket:t,...a}=e,n=L(a);return this.fetchBucket(t,"PUT",{realtimeLog:""},{},{...n})}async function rn(e){const{bucket:t}=e;try{return await this.fetchBucket(t,"GET",{realtimeLog:""},{})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketRealTimeLog",defaultResponse:{}})}}async function cn(e){const{bucket:t}=e;return this.fetchBucket(t,"DELETE",{realtimeLog:""},{})}var sn,ln,pn,un,dn,hn,fn;async function mn(e){try{return await this.fetchBucket(e.bucket,"GET",{inventory:"",id:e.id},{})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketInventory",defaultResponse:void 0})}}async function yn(e){const t={inventory:"",...e.continuationToken?{"continuation-token":e.continuationToken}:null};try{return await this.fetchBucket(e.bucket,"GET",t,{})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"listBucketInventory",defaultResponse:{InventoryConfigurations:[]}})}}async function gn(e){return this.fetchBucket(e.bucket,"DELETE",{inventory:"",id:e.id},{})}function xn(e){return this.fetchBucket(e.bucket,"PUT",{inventory:"",id:e.inventoryConfiguration.Id},{},e.inventoryConfiguration)}async function bn(e){const{accountId:t,...a}=e,n=L(a);return await this.fetch("POST","/jobs",{},{"x-tos-account-id":t},{...n})}async function kn(e){const{accountId:t,maxResults:a=1e3,...n}=e;return await this.fetch("GET","/jobs",{maxResults:a,...n},{"x-tos-account-id":t},{},{axiosOpts:{paramsSerializer:X}})}async function vn(e){const{accountId:t,jobId:a,priority:n}=e;return await this.fetch("POST",`/jobs/${a}/priority`,{priority:n},{"x-tos-account-id":t},{},{needMd5:!0})}async function Tn(e){const{accountId:t,jobId:a,requestedJobStatus:n,statusUpdateReason:o}=e;return await this.fetch("POST",`/jobs/${a}/status`,{requestedJobStatus:n,statusUpdateReason:o},{"x-tos-account-id":t},{},{needMd5:!0})}async function wn(e){const{accountId:t,JobId:a}=e;return await this.fetch("DELETE","/jobs/"+a,{},{"x-tos-account-id":t},{})}async function Sn(e){const{accountId:t,JobId:a}=e;return await this.fetch("GET","/jobs/"+a,{},{"x-tos-account-id":t},{})}async function En(e){return await this.fetchBucket(e.bucket,"PUT",{tagging:""},{},e.tagging,{needMd5:!0})}async function Cn({bucket:e}){try{return await this.fetchBucket(e,"GET",{tagging:""},{})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketTagging",defaultResponse:{TagSet:{Tags:[]}}})}}async function Pn({bucket:e}){return this.fetchBucket(e,"DELETE",{tagging:""},{})}async function Rn(e){return await this.fetchBucket(e.bucket,"PUT",{payByTraffic:""},{},e.payByTraffic)}async function Bn({bucket:e}){return await this.fetchBucket(e,"GET",{payByTraffic:""},{})}async function In(e){const{bucket:t}=e;try{return await this.fetchBucket(t,"GET",{imageStyleBriefInfo:""},{})}catch(e){if(e instanceof T&&404===e.statusCode)return this.getNormalDataFromError({BucketName:t,ImageStyleBriefInfo:[]},e);throw e}}async function An(e){try{return await this.fetchBucket(e,"GET",{imageStyle:""},{})}catch(e){if(e instanceof T&&404===e.statusCode)return this.getNormalDataFromError({ImageStyles:[]},e);throw e}}async function On(e){try{const{bucket:t,styleName:a}=e;return await this.fetchBucket(t,"GET",{imageStyleContent:"",styleName:a},{})}catch(e){if(e instanceof T&&404===e.statusCode)return this.getNormalDataFromError({ImageStyles:[]},e);throw e}}async function Mn(e,t){try{return await this.fetchBucket(e,"GET",{imageStyle:"",styleName:t},{})}catch(e){if(e instanceof T&&404===e.statusCode)return this.getNormalDataFromError(null,e);throw e}}async function Dn(e){const{bucket:t,styleName:a,content:n,styleObjectPrefix:o}=e;try{return await this.fetchBucket(t,"PUT",{imageStyle:"",styleName:a,styleObjectPrefix:o},{},{Content:n})}catch(e){if(e instanceof T&&404===e.statusCode)return this.getNormalDataFromError(null,e);throw e}}async function jn(e){const{styleName:t,styleObjectPrefix:a,bucket:n}=e;try{return await this.fetchBucket(n,"DELETE",{imageStyle:"",styleName:t,styleObjectPrefix:a},{})}catch(e){if(e instanceof T&&404===e.statusCode)return this.getNormalDataFromError(null,e);throw e}}async function _n(e,t){try{return await this.fetchBucket(e,"PUT",{originalImageProtect:""},{},t)}catch(e){if(e instanceof T&&404===e.statusCode)return this.getNormalDataFromError(null,e);throw e}}async function Ln(e){try{return await this.fetchBucket(e,"GET",{originalImageProtect:""},{})}catch(e){if(e instanceof T&&404===e.statusCode)return this.getNormalDataFromError(null,e);throw e}}async function Un(e){const{bucket:t,Separator:a,SeparatorSuffix:n}=e;try{return await this.fetchBucket(t,"PUT",{imageStyleSeparator:""},{},{Separator:a,SeparatorSuffix:n})}catch(e){if(e instanceof T&&404===e.statusCode)return this.getNormalDataFromError(null,e);throw e}}async function Nn(e){try{return await this.fetchBucket(e,"GET",{imageStyleSeparator:""},{})}catch(e){if(e instanceof T&&404===e.statusCode)return this.getNormalDataFromError(null,e);throw e}}async function zn(e){try{return await this.fetchBucket(e,"GET",{intelligenttiering:""},{})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketIntelligenttiering",defaultResponse:{}})}}async function Fn(e){const{bucket:t,...a}=e,n=L(a);return this.fetchBucket(t,"PUT",{rename:""},{},{...n})}async function Kn(e){const{bucket:t}=e;return await this.fetchBucket(t,"GET",{rename:""},{})}async function qn(e){const{bucket:t}=e;return this.fetchBucket(t,"DELETE",{rename:""},{})}async function Gn(e){const{versionId:t,...a}=e,n={restore:""};t&&(n.versionId=t);const o=L(a);return this._fetchObject(e,"POST",n,{},o)}async function $n(e){const{accountId:t}=e;return await this.fetch("GET","/storagelens",{},{"x-tos-account-id":t},{},{axiosOpts:{paramsSerializer:X}})}async function Hn(e){const{accountId:t,Id:a}=e;return await this.fetch("DELETE","/storagelens",{id:a},{"x-tos-account-id":t},{},{needMd5:!0})}async function Wn(e){const{accountId:t,Id:a}=e;return await this.fetch("GET","/storagelens",{id:a},{"x-tos-account-id":t},{},{needMd5:!0})}async function Vn(e){const{accountId:t,Id:a,...n}=e;return await this.fetch("PUT","/storagelens",{id:a},{"x-tos-account-id":t},{...n,Id:a},{needMd5:!0})}async function Jn(e){const{bucket:t,...a}=e,n=L(a);return this.fetchBucket(t,"PUT",{notification_v2:""},{},{...n})}async function Qn(e){const{bucket:t}=e;try{return await this.fetchBucket(t,"GET",{notification_v2:""},{})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketNotificationType2",defaultResponse:{Rules:[]}})}}async function Xn(e){return Yn.call(this,e)}async function Yn(e){const t=e.headers=N(e.headers);return Q(e,["symLinkTargetKey","symLinkTargetBucket","forbidOverwrite","acl","storageClass","meta"]),this._fetchObject(e,"PUT",{symlink:""},t,void 0,{handleResponse(e){const{headers:t}=e;return{VersionID:t["x-tos-version-id"]}}})}async function Zn(e){return eo.call(this,e)}async function eo(e){const t={symlink:""};return e.versionId&&(t.versionId=e.versionId),this._fetchObject(e,"GET",t,{},void 0,{handleResponse:e=>{const{headers:t}=e;return{VersionID:t["x-tos-version-id"],SymlinkTargetKey:t["x-tos-symlink-target"],SymlinkTargetBucket:t["x-tos-symlink-bucket"],LastModified:t["last-modified"]}}})}async function to(e){const{bucket:t,...a}=e,n=L(a);return this.fetchBucket(t,"PUT",{transferAcceleration:""},{},{...n})}async function ao(e){try{const{bucket:t}=e,a={};return e.getStatus&&(a["x-tos-get-bucket-acceleration-status"]="true"),await this.fetchBucket(t,"GET",{transferAcceleration:""},a)}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketTransferAcceleration",defaultResponse:{TransferAccelerationConfiguration:{Enabled:"false",Status:exports.TransferAccelerationStatusType.Terminated}}})}}async function no(e){const{bucket:t,status:a}=e;return this.fetchBucket(t,"PUT",{accessmonitor:""},{},{Status:a})}async function oo(e){try{const{bucket:t}=e;return await this.fetchBucket(t,"GET",{accessmonitor:""},{})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketAccessMonitor",defaultResponse:{}})}}async function io(e){const{accountId:t}=e;return await this.fetch("GET","/qospolicy",{},{"x-tos-account-id":t},{},{})}async function ro(e){const{accountId:t,...a}=e;return await this.fetch("PUT","/qospolicy",{},{"x-tos-account-id":t},{...a},{})}async function co(e){const{accountId:t}=e;return await this.fetch("DELETE","/qospolicy",{},{"x-tos-account-id":t},{},{})}async function so(e){const{accountId:t,name:a,regions:n}=e;return await this.fetch("POST","/mrap",{name:a},{"x-tos-account-id":t},{Name:a,Regions:n},{})}async function lo(e){const{name:t,accountId:a}=e;return await this.fetch("GET","/mrap",{name:t},{"x-tos-account-id":a},{},{})}async function po(e){const{accountId:t,...a}=e;return await this.fetch("GET","/mrap",{...a},{"x-tos-account-id":t},{},{})}async function uo(e){const{accountId:t,alias:a}=e;return await this.fetch("GET","/mrap/routes",{alias:a},{"x-tos-account-id":t})}async function ho(e){const{name:t,accountId:a}=e;return await this.fetch("DELETE","/mrap",{name:t},{"x-tos-account-id":a})}async function fo(e){const{routes:t,accountId:a,alias:n}=e;return await this.fetch("PATCH","/mrap/routes",{alias:n},{"x-tos-account-id":a},{Routes:t})}async function mo(e){const{AccountId:t,MultiRegionAccessPointAlias:a,AcceleratorId:n}=e;return await this.fetch("PUT",`/accelerator/${n}/mrap/${a}`,{},{"x-tos-account-id":t},{},{})}async function yo(e){const{AccountId:t,MultiRegionAccessPointAlias:a,AcceleratorId:n}=e;return await this.fetch("DELETE",`/accelerator/${n}/mrap/${a}`,{},{"x-tos-account-id":t},{},{})}async function go(e){const{AccountId:t,AcceleratorId:a}=e;return await this.fetch("GET",`/accelerator/${a}/mrap`,{},{"x-tos-account-id":t},{},{})}async function xo(e){const{BucketAccountId:t,Name:a,AccountId:n,Bucket:o,NetworkOrigin:i,VpcId:r}=e;return await this.fetch("PUT","/accesspoint/"+a,{name:""},{"x-tos-account-id":n},{BucketAccountId:t,Bucket:o,NetworkOrigin:i,VpcId:r},{})}async function bo(e){const{Name:t,AccountId:a}=e;return await this.fetch("GET","/accesspoint/"+t,{},{"x-tos-account-id":a},{},{})}async function ko(e){const{AccountId:t,...a}=e;return await this.fetch("GET","/accesspoint",{...a},{"x-tos-account-id":t},{},{})}async function vo(e){const{Name:t,AccountId:a}=e;return await this.fetch("DELETE","/accesspoint/"+t,{},{"x-tos-account-id":a})}async function To(e){const{AccountId:t,AcceleratorAccountId:a,AccessPointName:n,AcceleratorId:o}=e;return await this.fetch("PUT",`/accesspoint/${n}/accelerator/${o}`,{},{"x-tos-account-id":t},{AcceleratorAccountId:a},{})}async function wo(e){const{AccountId:t,AccessPointName:a,AcceleratorId:n}=e;return await this.fetch("DELETE",`/accesspoint/${a}/accelerator/${n}`,{},{"x-tos-account-id":t},{},{})}async function So(e){const{AccountId:t,AcceleratorId:a,...n}=e;return await this.fetch("GET",`/accelerator/${a}/accesspoint`,{...n},{"x-tos-account-id":t},{},{})}async function Eo(e){const{AccountId:t,...a}=e;return await this.fetch("POST","/accelerator",{name:""},{"x-tos-account-id":t},{...a},{})}async function Co(e){const{Id:t,AccountId:a}=e;return await this.fetch("GET","/accelerator",{id:t},{"x-tos-account-id":a},{},{})}async function Po(e){const{AccountId:t,...a}=e;return await this.fetch("GET","/accelerator",{...a},{"x-tos-account-id":t},{},{})}async function Ro(e){const{Id:t,AccountId:a}=e;return await this.fetch("DELETE","/accelerator",{id:t},{"x-tos-account-id":a})}async function Bo(e){const{AccountId:t,...a}=e;return await this.fetch("GET","/accelerator/az",{...a},{"x-tos-account-id":t},{},{})}async function Io(e){const{AccountId:t,...a}=e;return await this.fetch("POST","/accelerator/prefetchJob",{acceleratorId:a.AcceleratorId},{"x-tos-account-id":t},{...a},{})}async function Ao(e){const{AccountId:t,JobId:a}=e;return await this.fetch("GET","/accelerator/prefetchJob",{jobId:a},{"x-tos-account-id":t},{},{})}async function Oo(e){const{JobId:t,AccountId:a}=e;return await this.fetch("DELETE","/accelerator/prefetchJob",{jobId:t},{"x-tos-account-id":a})}async function Mo(e){const{AccountId:t,AcceleratorId:a,...n}=e;return await this.fetch("GET","/accelerator/prefetchJob",{acceleratorId:a,...n},{"x-tos-account-id":t},{},{})}async function Do(e){const{AccountId:t,JobId:a,...n}=e;return await this.fetch("GET","/accelerator/prefetchRecord",{jobId:a,...n},{"x-tos-account-id":t},{},{})}!function(e){e.Daily="Daily",e.Weekly="Weekly"}(sn||(sn={})),function(e){e.All="All",e.Current="Current"}(ln||(ln={})),function(e){e.Size="Size",e.LastModifiedDat="LastModifiedDate",e.ETag="ETag",e.StorageClass="StorageClass",e.IsMultipartUploaded="IsMultipartUploaded",e.EncryptionStatus="EncryptionStatus",e.CRC64="CRC64",e.ReplicationStatus="ReplicationStatus",e.RetentionMode="RetentionMode",e.RetainUntilTimestamp="RetainUntilTimestamp"}(pn||(pn={})),function(e){e.StringEquals="StringEquals",e.StringNotEquals="StringNotEquals",e.StringEqualsIgnoreCase="StringEqualsIgnoreCase",e.StringNotEqualsIgnoreCase="StringNotEqualsIgnoreCase",e.StringLike="StringLike",e.StringNotLike="StringNotLike"}(un||(un={})),function(e){e.DateEquals="DateEquals",e.DateNotEquals="DateNotEquals",e.DateLessThan="DateLessThan",e.DateLessThanEquals="DateLessThanEquals",e.DateGreaterThan="DateGreaterThan",e.DateGreaterThanEquals="DateGreaterThanEquals"}(dn||(dn={})),function(e){e.IpAddress="IpAddress",e.NotIpAddress="NotIpAddress"}(hn||(hn={})),function(e){e.WritesQps="WritesQps",e.ReadsQps="ReadsQps",e.ListQps="ListQps",e.WritesRate="WritesRate",e.ReadsRate="ReadsRate"}(fn||(fn={}));const jo=async function(e){const{accountId:t,alias:a,rules:n}=e;return this.opts.enableOptimizeMethodBehavior&&!n.length?Lo.call(this,{accountId:t,alias:a}):await this.fetch("PUT","/mrap/mirror",{alias:a},{"x-tos-account-id":t},{Rules:n},{handleResponse:()=>({})})},_o=async function(e){const{accountId:t,alias:a}=e;try{const e=await this.fetch("GET","/mrap/mirror",{alias:a},{"x-tos-account-id":t},{},{});return D(e.data)("Rules"),e}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getMultiRegionAccessPointMirrorBack",defaultResponse:{Rules:[]}})}},Lo=async function(e){const{accountId:t,alias:a}=e;return await this.fetch("DELETE","/mrap/mirror",{alias:a},{"x-tos-account-id":t},{},{handleResponse:()=>({})})};async function Uo(e){const{bucket:t,enable:a}=e;return await this.fetchBucket(t,"PUT",{privateM3U8:""},{},{Enable:a})}async function No(e){const{bucket:t}=e;try{return await this.fetchBucket(t,"GET",{privateM3U8:""},{})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketPrivateM3U8",defaultResponse:{Enable:!1}})}}async function zo(e){const{bucket:t,enable:a}=e;return await this.fetchBucket(t,"PUT",{blindWatermark:""},{},{Enable:a})}async function Fo(e){const{bucket:t}=e;try{return await this.fetchBucket(t,"GET",{blindWatermark:""},{})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketBlindWatermark",defaultResponse:{Enable:!1}})}}async function Ko(e){const{bucket:t,...a}=e,n=L(a);return this.fetchBucket(t,"PUT",{trash:""},{},{...n})}async function qo(e){const{bucket:t}=e;return await this.fetchBucket(t,"GET",{trash:""},{})}async function Go(e){const{bucket:t,objectLockEnabled:a,rule:n}=e;return this.fetchBucket(t,"PUT",{"object-lock":""},{},{ObjectLockEnabled:a,Rule:n})}async function $o(e){const{bucket:t}=e;try{return await this.fetchBucket(t,"GET",{"object-lock":""},{})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketObjectLockConfiguration",defaultResponse:{}})}}async function Ho(e){const{versionId:t,mode:a,retainUntilDate:n}=e,o={retention:""};return t&&(o.versionId=t),this._fetchObject(e,"PUT",o,{},{Mode:a,RetainUntilDate:n})}async function Wo(e){const{versionId:t}=e,a={retention:""};t&&(a.versionId=t);try{return await this._fetchObject(e,"GET",a,{})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getObjectRetention",defaultResponse:{}})}}async function Vo(e){const{bucket:t,role:a,rules:n}=e;return this.opts.enableOptimizeMethodBehavior&&!n.length?Qo.call(this,{bucket:t}):this.fetchBucket(t,"PUT",{cdn_notification:""},{},{Role:a,Rules:n})}async function Jo(e){const{bucket:t}=e;try{return await this.fetchBucket(t,"GET",{cdn_notification:""},{})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketCdnNotification",defaultResponse:{Rules:[],Role:""}})}}async function Qo(e){const{bucket:t}=e;return await this.fetchBucket(t,"DELETE",{cdn_notification:""},{})}async function Xo(e){const{bucket:t,role:a,rules:n}=e;return this.opts.enableOptimizeMethodBehavior&&!n.length?Zo.call(this,{bucket:t}):this.fetchBucket(t,"PUT",{workflow:""},{},{Role:a,Rules:n})}async function Yo(e){const{bucket:t}=e;try{return await this.fetchBucket(t,"GET",{workflow:""},{})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketWorkflow",defaultResponse:{Rules:[]}})}}async function Zo(e){const{bucket:t}=e,a=await this.fetchBucket(t,"DELETE",{workflow:""},{});return a.data||(a.data={}),a}async function ei(e){const{bucket:t,executionId:a}=e;try{return await this.fetchBucket(t,"GET",{workflow_execution:"",id:a},{})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketWorkflowExecution",defaultResponse:null})}}async function ti(e){const{bucket:t,workflowId:a,startTime:n,endTime:o,states:i,orderByTime:r,pageSize:c,pageToken:s}=e;try{const e={workflow_execution:""};return a&&(e.workflow_id=a),void 0!==n&&(e.start_time=n.toString()),void 0!==o&&(e.end_time=o.toString()),i&&(e.states=i),r&&(e.order_by_time=r),void 0!==c&&(e.page_size=c.toString()),s&&(e.page_token=s),await this.fetchBucket(t,"GET",e,{})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"listBucketWorkflowExecution",defaultResponse:{Items:[]}})}}async function ai(e){const{bucket:t,Input:a,FileCompressConfig:n,Output:o}=e;return await this.fetchBucket(t,"POST",{file_jobs:"",job_type:"FileCompress"},{},{Input:a,FileCompressConfig:n,Output:o})}async function ni(e){const{bucket:t,Input:a,FileUncompressConfig:n,Output:o}=e;return await this.fetchBucket(t,"POST",{file_jobs:"",job_type:"FileUncompress"},{},{Input:a,FileUncompressConfig:n,Output:o})}async function oi(e){try{return await this.fetchBucket(e.bucket,"GET",{logging:""},{})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketLogging",defaultResponse:void 0})}}function ii(e){return this.fetchBucket(e.bucket,"PUT",{logging:""},{},{LoggingEnabled:{TargetBucket:e.data.targetBucket,TargetPrefix:e.data.targetPrefix,Role:e.data.role}})}function ri(e){return this.fetchBucket(e.bucket,"PUT",{logging:""},{},{})}async function ci(e){var t;const{accountId:a,name:n,policy:o}=e;return!this.opts.enableOptimizeMethodBehavior||null!=(t=o.Statement)&&t.length?this.fetch("PUT",`/accesspoint/${n}/policy`,{},{"x-tos-account-id":a},o):li.call(this,{accountId:a,name:n})}async function si(e){const{accountId:t,name:a}=e;try{return await this.fetch("GET",`/accesspoint/${a}/policy`,{},{"x-tos-account-id":t},void 0,{handleResponse:e=>({Policy:e.data})})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getAccessPointPolicy",defaultResponse:{Policy:{Version:"2012-10-17",Statement:[]}}})}}async function li(e){const{accountId:t,name:a}=e;return this.fetch("DELETE",`/accesspoint/${a}/policy`,{},{"x-tos-account-id":t})}async function pi(e){var t;const{accountId:a,name:n,policy:o}=e;return!this.opts.enableOptimizeMethodBehavior||null!=(t=o.Statement)&&t.length?await this.fetch("PUT",`/mrap/${n}/policy`,{},{"x-tos-account-id":a},o,{}):di.call(this,{accountId:a,name:n})}async function ui(e){const{accountId:t,name:a}=e;try{return await this.fetch("GET",`/mrap/${a}/policy`,{},{"x-tos-account-id":t},void 0,{handleResponse:e=>({Policy:e.data})})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getMultiRegionAccessPointMirrorBack",defaultResponse:{Policy:{Version:"2012-10-17",Statement:[]}}})}}async function di(e){const{accountId:t,name:a}=e;return await this.fetch("DELETE",`/mrap/${a}/policy`,{},{"x-tos-account-id":t},{},{handleResponse:()=>({})})}async function hi(e){const{bucket:t}=e;try{return await this.fetchBucket(t,"GET",{audit:""},{})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketAudit",defaultResponse:null})}}async function fi(e){const{bucket:t,action:a}=e;return await this.fetchBucket(t,"PUT",{action:a,audit:""},{})}async function mi(e){const{bucket:t,startTime:a,endTime:n,pageSize:o,pageToken:i}=e,r={job_type:"AuditStock"};return void 0!==a&&(r.start_time=a.toString()),void 0!==n&&(r.end_time=n.toString()),void 0!==o&&(r.page_size=o.toString()),void 0!==i&&(r.page_token=i),await this.fetchBucket(t,"GET",r,{})}async function yi(e){const{bucket:t,jobId:a}=e;try{return await this.fetchBucket(t,"GET",{job_type:"AuditStock",job_id:a},{})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketAuditJob",defaultResponse:null})}}async function gi(e){const{bucket:t,job:a}=e;return await this.fetchBucket(t,"POST",{job_type:"AuditStock",audit_jobs:""},{},a)}async function xi(e){const{bucket:t,audit_type:a}=e;return this.fetchBucket(t,"GET",{type:a,audits:""},{})}async function bi(e){const{bucket:t,jobType:a,startTime:n,endTime:o,pageSize:i,pageToken:r}=e,c={job_type:a};return void 0!==n&&(c.start_time=n.toString()),void 0!==o&&(c.end_time=o.toString()),void 0!==i&&(c.page_size=i.toString()),void 0!==r&&(c.page_token=r),await this.fetchBucket(t,"GET",c,{})}async function ki(e){const{bucket:t,jobType:a,jobId:n}=e;try{return await this.fetchBucket(t,"GET",{job_type:a,job_id:n},{})}catch(e){return Ta(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketJob",defaultResponse:null})}}async function vi(e){const{bucket:t,Input:a,Output:n,AudioConvertConfig:o}=e,i=await this.fetchBucket(t,"POST",{job_type:"AudioConvert",media_jobs:""},{},{Input:a,AudioConvertConfig:o,Output:n});return i.data||(i.data={}),i}async function Ti(e){const{versionId:t}=e,a=N({versionId:t});return await this._fetchObject(e,"GET",{"x-tos-process":"image/aitag",...a},{})}async function wi(e){const{bucket:t,...a}=e,n=L(a);return this.fetchBucket(t,"PUT",{requestPayment:""},{},{...n})}async function Si(e){const{bucket:t}=e;return await this.fetchBucket(t,"GET",{requestPayment:""},{})}class Ei extends qt{constructor(...e){super(...e),this.createBucket=Qt,this.headBucket=Yt,this.deleteBucket=Xt,this.listBuckets=Jt,this.getBucketLocation=Aa,this.putBucketStorageClass=Zt,this.getBucketAcl=ta,this.putBucketAcl=ea,this.putBucketHttpsConfig=aa,this.getBucketHttpsConfig=na,this.getBucketPolicy=Sa,this.putBucketPolicy=wa,this.deleteBucketPolicy=Ea,this.getBucketVersioning=Ca,this.putBucketVersioning=Pa,this.getBucketCORS=Oa,this.putBucketCORS=Ma,this.deleteBucketCORS=Da,this.putBucketLifecycle=ja,this.getBucketLifecycle=_a,this.deleteBucketLifecycle=La,this.putBucketEncryption=Ua,this.getBucketEncryption=Na,this.deleteBucketEncryption=za,this.putBucketMirrorBack=Fa,this.getBucketMirrorBack=Ka,this.deleteBucketMirrorBack=qa,this.putBucketReplication=Wa,this.getBucketReplication=Va,this.deleteBucketReplication=Ja,this.putBucketWebsite=Qa,this.getBucketWebsite=Xa,this.deleteBucketWebsite=Ya,this.putBucketNotification=Za,this.getBucketNotification=en,this.putBucketCustomDomain=tn,this.getBucketCustomDomain=an,this.deleteBucketCustomDomain=nn,this.putBucketRealTimeLog=on,this.getBucketRealTimeLog=rn,this.deleteBucketRealTimeLog=cn,this.getBucketInventory=mn,this.listBucketInventory=yn,this.putBucketInventory=xn,this.deleteBucketInventory=gn,this.putBucketTagging=En,this.getBucketTagging=Cn,this.deleteBucketTagging=Pn,this.putBucketPayByTraffic=Rn,this.getBucketPayByTraffic=Bn,this.getBucketImageStyle=Mn,this.getBucketImageStyleList=An,this.getBucketImageStyleListByName=On,this.getImageStyleBriefInfo=In,this.deleteBucketImageStyle=jn,this.putBucketImageStyle=Dn,this.putBucketImageStyleSeparator=Un,this.putBucketImageProtect=_n,this.getBucketImageProtect=Ln,this.getBucketImageStyleSeparator=Nn,this.putBucketRename=Fn,this.getBucketRename=Kn,this.deleteBucketRename=qn,this.putBucketTransferAcceleration=to,this.getBucketTransferAcceleration=ao,this.copyObject=Ct,this.resumableCopyObject=Rt,this.deleteObject=pa,this.deleteMultiObjects=da,this.getObject=It,this.getObjectV2=Ot,this.getObjectToFile=Mt,this.getObjectAcl=ha,this.headObject=St,this.appendObject=ga,this.listObjects=Gt,this.renameObject=ua,this.fetchObject=ca,this.putFetchTask=sa,this.listObjectsType2=Ht,this.listObjectVersions=$t,this.putObject=oa,this.putObjectFromFile=ra,this.putObjectAcl=fa,this.setObjectMeta=xa,this.createMultipartUpload=se,this.uploadPart=Ge,this.uploadPartFromFile=$e,this.completeMultipartUpload=He,this.abortMultipartUpload=ma,this.uploadPartCopy=Et,this.listMultipartUploads=ya,this.listParts=pe,this.downloadFile=_t,this.putObjectTagging=Ga,this.getObjectTagging=$a,this.deleteObjectTagging=Ha,this.listJobs=kn,this.createJob=bn,this.deleteJob=wn,this.describeJob=Sn,this.updateJobStatus=Tn,this.updateJobPriority=vn,this.restoreObject=Gn,this.uploadFile=Qe,this.getPreSignedUrl=la,this.calculatePostSignature=ba,this.preSignedPostSignature=ba,this.preSignedPolicyURL=Ra,this.getBucketIntelligenttiering=zn,this.listStorageLens=$n,this.deleteStorageLens=Hn,this.getStorageLens=Wn,this.putStorageLens=Vn,this.putBucketNotificationType2=Jn,this.getBucketNotificationType2=Qn,this.putSymlink=Xn,this.getSymlink=Zn,this.putBucketAccessMonitor=no,this.getBucketAccessMonitor=oo,this.putQosPolicy=ro,this.getQosPolicy=io,this.deleteQosPolicy=co,this.createMultiRegionAccessPoint=so,this.getMultiRegionAccessPoint=lo,this.listMultiRegionAccessPoints=po,this.getMultiRegionAccessPointRoutes=uo,this.deleteMultiRegionAccessPoint=ho,this.submitMultiRegionAccessPointRoutes=fo,this.bindAcceleratorWithMultiRegionAccessPoint=mo,this.unbindAcceleratorWithMultiRegionAccessPoint=yo,this.listBindAccessPointForMultiRegionAccelerator=go,this.putMultiRegionAccessPointMirrorBack=jo,this.getMultiRegionAccessPointMirrorBack=_o,this.deleteMultiRegionAccessPointMirrorBack=Lo,this.putMultiRegionAccessPointPolicy=pi,this.getMultiRegionAccessPointPolicy=ui,this.deleteMultiRegionAccessPointPolicy=di,this.putAccessPointPolicy=ci,this.getAccessPointPolicy=si,this.deleteAccessPointPolicy=li,this.createAccessPoint=xo,this.getAccessPoint=bo,this.listAccessPoints=ko,this.deleteAccessPoint=vo,this.bindAcceleratorWithAccessPoint=To,this.unbindAcceleratorWithAccessPoint=wo,this.listBindAccessPointForAccelerator=So,this.listAcceleratorAzs=Bo,this.putAccelerator=Eo,this.getAccelerator=Co,this.listAccelerators=Po,this.deleteAccelerator=Ro,this.putAcceleratorPrefetchJob=Io,this.getAcceleratorPrefetchJob=Ao,this.deleteAcceleratorPrefetchJob=Oo,this.listAcceleratorPrefetchJobs=Mo,this.listAcceleratorPrefetchJobRecords=Do,this.putBucketPrivateM3U8=Uo,this.getBucketPrivateM3U8=No,this.putBucketBlindWatermark=zo,this.getBucketBlindWatermark=Fo,this.putBucketTrash=Ko,this.getBucketTrash=qo,this.putBucketObjectLockConfiguration=Go,this.getBucketObjectLockConfiguration=$o,this.putObjectRetention=Ho,this.getObjectRetention=Wo,this.putBucketCdnNotification=Vo,this.getBucketCdnNotification=Jo,this.deleteBucketCdnNotification=Qo,this.putBucketWorkflow=Xo,this.getBucketWorkflow=Yo,this.deleteBucketWorkflow=Zo,this.getBucketWorkflowExecution=ei,this.listBucketWorkflowExecution=ti,this.putBucketAudit=fi,this.getBucketAudit=hi,this.listBucketAuditJob=mi,this.getBucketAuditJob=yi,this.postBucketAuditJob=gi,this.listBucketAuditBizType=xi,this.createFileCompress=ai,this.createFileUncompress=ni,this.createBucketAudioConvert=vi,this.listBucketJob=bi,this.getBucketJob=ki,this.putBucketLogging=ii,this.getBucketLogging=oi,this.deleteBucketLogging=ri,this.getObjectAITag=Ti,this.putBucketRequestPayment=wi,this.getBucketRequestPayment=Si}}const Ci=a.CancelToken;class Pi extends Ei{}Pi.TosServerError=T,Pi.isCancel=H,Pi.CancelError=S,Pi.TosServerCode=exports.TosServerCode,Pi.TosClientError=w,Pi.CancelToken=Ci,Pi.ACLType=exports.ACLType,Pi.StorageClassType=exports.StorageClassType,Pi.MetadataDirectiveType=exports.MetadataDirectiveType,Pi.AzRedundancyType=exports.AzRedundancyType,Pi.PermissionType=exports.PermissionType,Pi.GranteeType=exports.GranteeType,Pi.CannedType=exports.CannedType,Pi.HttpMethodType=exports.HttpMethodType,Pi.LifecycleStatusType=exports.LifecycleStatusType,Pi.StatusType=exports.StatusType,Pi.RedirectType=exports.RedirectType,Pi.StorageClassInheritDirectiveType=exports.StorageClassInheritDirectiveType,Pi.TierType=exports.TierType,Pi.FileUncompressPrefixReplaced=exports.FileUncompressPrefixReplaced,Pi.FileCompressFlatten=exports.FileCompressFlatten,Pi.VersioningStatusType=exports.VersioningStatusType,Pi.createDefaultRateLimiter=ve,Pi.DataTransferType=exports.DataTransferType,Pi.UploadEventType=exports.UploadEventType,Pi.DownloadEventType=exports.DownloadEventType,Pi.ResumableCopyEventType=exports.ResumableCopyEventType,Pi.ReplicationStatusType=exports.ReplicationStatusType,Pi.AccessPointStatusType=exports.AccessPointStatusType,Pi.AccessPointStatus=exports.AccessPointStatus,Pi.AcceleratorPrefetchJobStatus=exports.AcceleratorPrefetchJobStatus,Pi.TransferAccelerationStatusType=exports.TransferAccelerationStatusType,Pi.MRAPMirrorBackRedirectPolicyType=exports.MRAPMirrorBackRedirectPolicyType,Pi.WorkflowExecutionStateType=exports.WorkflowExecutionStateType,Pi.ShareLinkClient=Vt,Pi.AuditJobStateType=exports.AuditJobStateType,Pi.AuditScanType=exports.AuditScanType,exports.CancelError=S,exports.CancelToken=Ci,exports.ShareLinkClient=Vt,exports.TOS=Pi,exports.TosClient=Pi,exports.TosClientError=w,exports.TosServerError=T,exports.createDefaultRateLimiter=ve,exports.default=Pi,exports.isCancel=H;
//# sourceMappingURL=tos.cjs.production.min.js.map
