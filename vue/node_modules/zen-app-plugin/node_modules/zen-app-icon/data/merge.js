const fs = require('fs')
const path = require('path')
const list = require('./list')
const categories = require('./userCategory')

// 生成合法的 JavaScript 变量名
function toValidVarName(filename) {
  const parts = filename.split('-')
  // 处理数组：第一个元素保持不变，其余元素首字母大写
  return parts
    .map(part => {
      // 首字母大写，其余字母保持不变
      return part.charAt(0).toUpperCase() + part.slice(1)
    })
    .join('')
}

function setCategory(category, name) {
  categories.forEach(current => {
    if (current.name === category) {
      current.sons.push(name)
    }
  })
}

function createIndex() {
  let allImport = []
  let allExport = []
  list.forEach(item => {
    item.categories.forEach(category => setCategory(category, item.name))
    const outName = toValidVarName(item.name)
    allImport.push(`import ${outName} from '../extend/${item.name}.js'`)
    allExport.push(`'${item.name}':${outName}`)
  })
  // 生成最终文件内容
  const outputContent = `${allImport.join(
    '\n'
  )} \nexport default {${allExport.join(',')}}`
  const outputFile = path.join(__dirname, 'all.js')
  // 写入文件
  fs.writeFileSync(outputFile, outputContent, 'utf8')

  const categoriesFile = path.join(__dirname, 'categories.js')
  fs.writeFileSync(
    categoriesFile,
    `export default ${JSON.stringify(categories)}`,
    'utf8'
  )

  console.log(`✅ 成功导出 ${allExport.length} 个图标`)
}

// 执行生成
createIndex()
